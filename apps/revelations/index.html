---
layout: default
custom_css: [revelations]
custom_js: []
permalink: /revelations/
redirect_from: 
  - /kr/revelations/
  - /kr/revelations/index.html
language: kr
title : ê³„ì‹œ - í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ X ë£¨í˜ë¥´ë„·
description: í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ Xì˜ ê³„ì‹œ ì •ë³´
alternate_urls:
  en: /revelations/?lang=en
  jp: /revelations/?lang=jp
---

{% if page.alternate_urls %}
<link rel="alternate" hreflang="ko" href="{{ site.url }}/revelations/" />
{% for lang in page.alternate_urls %}
<link rel="alternate" hreflang="{{ lang[0] }}" href="{{ site.url }}{{ lang[1] }}" />
{% endfor %}
<link rel="alternate" hreflang="x-default" href="{{ site.url }}/revelations/" />
{% endif %}

<!-- Main content -->
<div class="main-wrapper">
    <!-- ì–¸ì–´ ì•ˆë‚´ ë©”ì‹œì§€ -->
    <div id="language-notice" class="language-notice" style="display: none;">
        <p id="language-notice-text"></p>
    </div>
    
    <!-- Navigation path -->
    <div class="navigation-path">
        <script>document.write(`<a href="../../?v=${APP_VERSION}" id="nav-home">í™ˆ</a>`);</script>
        <span class="separator">/</span>
        <span class="current-page" id="nav-current">ê³„ì‹œ</span>
    </div>
    <div class="header-container">
        <h1 id="page-title">ê³„ì‹œ</h1>
    </div>

    <!-- Filter section -->
    <div class="filter-section">
        <div class="filter-content">
            <!-- Revelation type filter -->
            <div class="filter-group">
                <h3 id="filter-type-label">ë¶„ë¥˜</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="type" value="main">
                        <img src="{{ site.baseurl }}/assets/img/revelation/icon-ì£¼.png" alt="ì£¼ ì„±ìœ„">
                    </label>
                    <label>
                        <input type="checkbox" name="type" value="sub">
                        <div class="sub-icons">
                            <img src="{{ site.baseurl }}/assets/img/revelation/icon-ì¼.png" alt="ì¼ì›”ì„±ì§„">
                            <img src="{{ site.baseurl }}/assets/img/revelation/icon-ì›”.png" alt="ì¼ì›”ì„±ì§„">
                            <img src="{{ site.baseurl }}/assets/img/revelation/icon-ì„±.png" alt="ì¼ì›”ì„±ì§„">
                            <img src="{{ site.baseurl }}/assets/img/revelation/icon-ì§„.png" alt="ì¼ì›”ì„±ì§„">
                        </div>
                    </label>
                </div>
            </div>

            <!-- Element filter -->
            <div class="filter-group">
                <h3 id="filter-element-label">ì†ì„±</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="element" value="ë¬¼ë¦¬">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ë¬¼ë¦¬.png" alt="ë¬¼ë¦¬">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì´ê²©">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì´ê²©.png" alt="ì´ê²©">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="í™”ì—¼">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_í™”ì—¼.png" alt="í™”ì—¼">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ë¹™ê²°">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ë¹™ê²°.png" alt="ë¹™ê²°">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì „ê²©">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì „ê²©.png" alt="ì „ê²©">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì§ˆí’">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì§ˆí’.png" alt="ì§ˆí’">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì—¼ë™">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì—¼ë™.png" alt="ì—¼ë™">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="í•µì—´">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_í•µì—´.png" alt="í•µì—´">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì¶•ë³µ">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì¶•ë³µ.png" alt="ì¶•ë³µ">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì£¼ì›">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ì£¼ì›.png" alt="ì£¼ì›">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ë§ŒëŠ¥">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_ë§ŒëŠ¥.png" alt="ë§ŒëŠ¥">
                        <span></span>
                    </label>
                </div>
            </div>

            <!-- Type filter -->
            <div class="filter-group">
                <h3 id="filter-effect-label">íƒ€ì…</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="effect" value="ë²„í”„">
                        <p id="effect-buff">ë²„í”„</p>
                    </label>
                    <label>
                        <input type="checkbox" name="effect" value="ë””ë²„í”„">
                        <p id="effect-debuff">ë””ë²„í”„</p>
                    </label>
                    <label>
                        <input type="checkbox" name="effect" value="ì¶”ê°€ íš¨ê³¼">
                        <p id="effect-additional">ì¶”ê°€ íš¨ê³¼</p>
                    </label>
                    <label>
                        <input type="checkbox" name="effect" value="HL 25%">
                        <p id="effect-hl">HL 25%</p>
                    </label>
                    <label>
                        <input type="checkbox" name="effect" value="ì¹˜ë£Œ">
                        <p id="effect-heal">ì¹˜ë£Œ</p>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Separator line -->
    <div class="separator-line"></div>

    <!-- Search section -->
    <div class="search-section">
        <div class="search-container">
            <div class="search-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="rgba(255, 255, 255, 0.6)"/>
                </svg>
            </div>
            <input type="text" id="revelationSearch" placeholder="ê³„ì‹œ ê²€ìƒ‰..." autocomplete="off">
            <div id="searchDropdown" class="search-dropdown"></div>
        </div>
        <div class="search-count">
            <span id="filteredCount">ì „ì²´ 0ê°œ</span>
        </div>
    </div>

    <!-- Revelation Stats (Accordion) -->
    <div id="revelation-stats" class="rev-stats-section">
        <button class="rev-accordion" id="rev-accordion-btn">
            <span id="rev-stats-title">ê³„ì‹œ ìŠ¤íƒ¯</span>
            <svg class="chev" width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
        </button>
        <div class="rev-panel" id="rev-panel" style="display:none;">
            <!-- Tabs -->
            <div class="rev-tabs" role="tablist">
                <button class="rev-tab active" data-tab="uni" role="tab"><img src="{{ site.baseurl }}/assets/img/revelation/icon-ì£¼.png" alt="ì£¼"/> <span class="tab-text-uni">ì£¼</span></button>
                <button class="rev-tab" data-tab="sun" role="tab"><img src="{{ site.baseurl }}/assets/img/revelation/icon-ì¼.png" alt="ì¼"/> <span class="tab-text-sun">ì¼</span></button>
                <button class="rev-tab" data-tab="moon" role="tab"><img src="{{ site.baseurl }}/assets/img/revelation/icon-ì›”.png" alt="ì›”"/> <span class="tab-text-moon">ì›”</span></button>
                <button class="rev-tab" data-tab="star" role="tab"><img src="{{ site.baseurl }}/assets/img/revelation/icon-ì„±.png" alt="ì„±"/> <span class="tab-text-star">ì„±</span></button>
                <button class="rev-tab" data-tab="planet" role="tab"><img src="{{ site.baseurl }}/assets/img/revelation/icon-ì§„.png" alt="ì§„"/> <span class="tab-text-planet">ì§„</span></button>
            </div>

            <!-- Tab panels -->
            <div class="rev-tab-panels">
                <div class="rev-tab-panel" data-panel="uni"></div>
                <div class="rev-tab-panel" data-panel="sun" style="display:none;"></div>
                <div class="rev-tab-panel" data-panel="moon" style="display:none;"></div>
                <div class="rev-tab-panel" data-panel="star" style="display:none;"></div>
                <div class="rev-tab-panel" data-panel="planet" style="display:none;"></div>
            </div>
        </div>
    </div>

    <!-- moved styles to assets/css/revelations.css -->

    <!-- Revelation card container -->
    <div class="revelation-cards" id="revelationCards">
        <!-- Dynamically generated by JavaScript -->
    </div>

    <!-- ê´‘ê³  -->
  <div class="ads-container responsive-padding">
    <ins class="adsbygoogle"
      style="display:block"
      data-ad-format="fluid"
      data-ad-layout-key="-gc+3n+7a-ag-4h"
      data-ad-client="ca-pub-5862324369257695"
      data-ad-slot="5373524213"></ins>
    <script>(adsbygoogle = window.adsbygoogle || []).push({});</script>
  </div>
    
    <div id="ad-unit-bottom" class="AD-bottom" style="margin-top: 24px; text-align: center; align-items: center; display: flex; justify-content: center;"> 
    <ins class="adsbygoogle"
        style="display:inline-block;width:970px;height:90px"
        data-ad-client="ca-pub-5862324369257695"
        data-ad-slot="9244892982"></ins>
    </div>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <div style="height: 12px;"></div>
    <!---->
    <style>
        @media (max-width: 1440px) {
            .AD-bottom {
                display: none !important;
            }
        }
        @media (min-width: 1440px) {
            .ads-container {
                display: none !important;
            }
        }
        .responsive-padding { margin: 20px 20px 20px 0; padding: 0 0; }
        @media (max-width: 1200px) { .responsive-padding {margin: 20px 0 0px 0; padding: 0; } }
    </style>
</div>



<script>
    // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
    if (window.revelationData) delete window.revelationData;
    if (window.tooltipData) delete window.tooltipData;
    
    // ë™ì  ë°ì´í„° ë¡œë”© í•¨ìˆ˜
    async function loadLanguageData(lang) {
        return new Promise((resolve, reject) => {
            const dataFiles = {
                'kr': '/data/kr/revelations/revelations.js',
                'en': '/data/en/revelations/revelations.js', 
                'jp': '/data/jp/revelations/revelations.js'
            };

            const scriptSrc = dataFiles[lang] || dataFiles['kr'];
            
            // ê¸°ì¡´ ìŠ¤í¬ë¦½íŠ¸ ì œê±° (ì¤‘ë³µ ë°©ì§€)
            const existingTooltip = document.querySelector('script[src="/data/kr/tooltip.js"]');
            if (existingTooltip) existingTooltip.remove();
            
            // ëª¨ë“  ê¸°ì¡´ revelation ìŠ¤í¬ë¦½íŠ¸ ì œê±°
            document.querySelectorAll('script[src*="revelations.js"]').forEach(script => script.remove());
            
            // tooltip.js ë¡œë“œ
            const tooltipScript = document.createElement('script');
            tooltipScript.src = '/data/kr/tooltip.js';
            tooltipScript.onload = () => {
                // tooltip.js ë¡œë“œ í›„ revelations ë°ì´í„° ë¡œë“œ
                const dataScript = document.createElement('script');
                dataScript.src = scriptSrc;
                dataScript.onload = () => {
                    // ì–¸ì–´ë³„ ì „ì—­ ë³€ìˆ˜ ì„¤ì •
                    setTimeout(() => {
                        if (lang === 'en' && typeof enRevelationData !== 'undefined') {
                            window.enRevelationData = enRevelationData;
                            //console.log('English revelation data loaded:', enRevelationData);
                        } else if (lang === 'jp' && typeof jpRevelationData !== 'undefined') {
                            window.jpRevelationData = jpRevelationData;
                            //console.log('Japanese revelation data loaded:', jpRevelationData);
                        } else if (lang === 'kr' && typeof revelationData !== 'undefined') {
                            //console.log('Korean revelation data loaded:', revelationData);
                        } else {
                            console.warn('No revelation data found for language:', lang);
                        }
                        
                        // ë°ì´í„° ë¡œë“œ í›„ addTooltips í•¨ìˆ˜ ì •ì˜
                        window.addTooltips = function() {
                            const tooltips = document.querySelectorAll('[data-tooltip]');
                            tooltips.forEach(element => {
                                const tooltipText = element.getAttribute('data-tooltip');
                                // íˆ´íŒ ë¡œì§ êµ¬í˜„
                                element.title = tooltipText;
                            });
                        };
                        resolve();
                    }, 100); // 100ms ì§€ì—°ìœ¼ë¡œ ë°ì´í„° ë¡œë”© ì™„ë£Œ ë³´ì¥
                };
                dataScript.onerror = () => reject(new Error(`Failed to load ${scriptSrc}`));
                document.head.appendChild(dataScript);
            };
            tooltipScript.onerror = () => reject(new Error('Failed to load tooltip.js'));
            document.head.appendChild(tooltipScript);
        });
    }

    // ìºë¦­í„° ë°ì´í„° ë¡œë” (KR ë°ì´í„° ì‚¬ìš©)
    async function loadCharacterData() {
        return new Promise((resolve, reject) => {
            // ì¤‘ë³µ ë¡œë”© ë°©ì§€
            document.querySelectorAll('script[src*="/data/kr/characters/characters.js"]').forEach(s => s.remove());
            const s = document.createElement('script');
            s.src = '/data/kr/characters/characters.js';
            s.onload = () => resolve();
            s.onerror = () => reject(new Error('Failed to load /data/kr/characters/characters.js'));
            document.head.appendChild(s);
        });
    }

    // ë‹¤êµ­ì–´ ì§€ì› í•¨ìˆ˜
    async function updateLanguageContent() {
        const currentLang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // ë‹¤êµ­ì–´ ë°ì´í„° ì •ì˜
        const i18nData = {
            kr: {
                language_notice: "",
                nav_home: "í™ˆ",
                nav_current: "ê³„ì‹œ",
                page_title: "ê³„ì‹œ",
                filtered_count: "ì „ì²´",
                search_placeholder: "ê³„ì‹œ ê²€ìƒ‰...",
                filter_type: "ë¶„ë¥˜",
                filter_element: "ì†ì„±",
                filter_effect: "íƒ€ì…",
                effect_buff: "ë²„í”„",
                effect_debuff: "ë””ë²„í”„",
                effect_additional: "ì¶”ê°€ íš¨ê³¼",
                effect_hl: "HL 25%",
                effect_heal: "ì¹˜ë£Œ",
                count_unit: "ê°œ",
                set_effect_2: "2ì„¸íŠ¸",
                set_effect_4: "4ì„¸íŠ¸",
                label_characters: "ì‚¬ìš© ìºë¦­í„°"
            },
            en: {
                language_notice: "ğŸŒ Please let me know if you find an accurate translation.\nIt may contain content that hasn't been released yet.",
                nav_home: "Home",
                nav_current: "Revelations",
                page_title: "Revelations",
                filtered_count: "Total",
                search_placeholder: "Search revelations...",
                filter_type: "Type",
                filter_element: "Element",
                filter_effect: "Effect",
                effect_buff: "Buff",
                effect_debuff: "Debuff",
                effect_additional: "Follow-up",
                effect_hl: "HL 25%",
                effect_heal: "Heal",
                count_unit: "",
                set_effect_2: "2-Set",
                set_effect_4: "4-Set",
                label_characters: "Characters"
            },
            jp: {
                language_notice: "ğŸŒ æ­£ç¢ºãªç¿»è¨³ãŒè¦‹ã¤ã‹ã£ãŸå ´åˆã¯ã€ãŠçŸ¥ã‚‰ã›ãã ã•ã„ã€‚\nã¾ã ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
                nav_home: "ãƒ›ãƒ¼ãƒ ",
                nav_current: "å•“ç¤º",
                page_title: "å•“ç¤º",
                filtered_count: "å…¨ä½“",
                search_placeholder: "å•“ç¤ºæ¤œç´¢...",
                filter_type: "åˆ†é¡",
                filter_element: "å±æ€§",
                filter_effect: "ã‚¿ã‚¤ãƒ—",
                effect_buff: "ãƒãƒ•",
                effect_debuff: "ãƒ‡ãƒãƒ•",
                effect_additional: "æ„è­˜å¥åŠŸ",
                effect_hl: "HL 25%",
                effect_heal: "å›å¾©",
                count_unit: "",
                set_effect_2: "2ã‚»ãƒƒãƒˆ",
                set_effect_4: "4ã‚»ãƒƒãƒˆ",
                label_characters: "ä½¿ç”¨ã‚­ãƒ£ãƒ©"
            }
        };
        
        const data = i18nData[currentLang];
        if (!data) return;
        
        // ì–¸ì–´ ì•ˆë‚´ ë©”ì‹œì§€
        if (currentLang !== 'kr') {
            const notice = document.getElementById('language-notice');
            const noticeText = document.getElementById('language-notice-text');
            if (notice && noticeText && data.language_notice) {
                noticeText.textContent = data.language_notice;
                notice.style.display = 'block';
            }
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë° ì œëª© ì—…ë°ì´íŠ¸
        const navHome = document.getElementById('nav-home');
        const navCurrent = document.getElementById('nav-current');
        const pageTitle = document.getElementById('page-title');
        const searchInput = document.getElementById('revelationSearch');
        
        if (navHome) navHome.textContent = data.nav_home;
        if (navCurrent) navCurrent.textContent = data.nav_current;
        if (pageTitle) pageTitle.textContent = data.page_title;
        if (searchInput) searchInput.placeholder = data.search_placeholder;
        
        // í•„í„° ë¼ë²¨ ì—…ë°ì´íŠ¸
        const filterTypeLabel = document.getElementById('filter-type-label');
        const filterElementLabel = document.getElementById('filter-element-label');
        const filterEffectLabel = document.getElementById('filter-effect-label');
        
        if (filterTypeLabel) filterTypeLabel.textContent = data.filter_type;
        if (filterElementLabel) filterElementLabel.textContent = data.filter_element;
        if (filterEffectLabel) filterEffectLabel.textContent = data.filter_effect;
        
        // íš¨ê³¼ íƒ€ì… ë¼ë²¨ ì—…ë°ì´íŠ¸
        const effectBuff = document.getElementById('effect-buff');
        const effectDebuff = document.getElementById('effect-debuff');
        const effectAdditional = document.getElementById('effect-additional');
        const effectHl = document.getElementById('effect-hl');
        const effectHeal = document.getElementById('effect-heal');
        
        if (effectBuff) effectBuff.textContent = data.effect_buff;
        if (effectDebuff) effectDebuff.textContent = data.effect_debuff;
        if (effectAdditional) effectAdditional.textContent = data.effect_additional;
        if (effectHl) effectHl.textContent = data.effect_hl;
        if (effectHeal) effectHeal.textContent = data.effect_heal;
        
        // í•„í„° ì¹´ìš´íŠ¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.i18nFilteredCount = data.filtered_count;
        window.i18nCountUnit = data.count_unit;
        window.i18nSetEffect2 = data.set_effect_2;
        window.i18nSetEffect4 = data.set_effect_4;
    }

    // ì–¸ì–´ë³„ SEO ì„¤ì • í•¨ìˆ˜
    function updateSEOContent() {
        const currentLang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        const seoData = {
            'kr': {
                title: 'ê³„ì‹œ - í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ X ë£¨í˜ë¥´ë„·',
                description: 'í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ Xì˜ ê³„ì‹œ ì •ë³´. ì„¸íŠ¸ íš¨ê³¼ì™€ ì¶”ê°€ íš¨ê³¼ë¥¼ í™•ì¸í•˜ì„¸ìš”.'
            },
            'en': {
                title: 'Revelations - Persona 5: The Phantom X LufelNet',
                description: 'Revelation information for Persona 5: The Phantom X. Check set effects and additional effects.'
            },
            'jp': {
                title: 'å•“ç¤º - ãƒšãƒ«ã‚½ãƒŠ5 ã‚¶ãƒ»ãƒ•ã‚¡ãƒ³ãƒˆãƒ  X LufelNet',
                description: 'ãƒšãƒ«ã‚½ãƒŠ5 ã‚¶ãƒ»ãƒ•ã‚¡ãƒ³ãƒˆãƒ  Xã®å•“ç¤ºæƒ…å ±ã€‚ã‚»ãƒƒãƒˆåŠ¹æœã¨è¿½åŠ åŠ¹æœã‚’ã”ç¢ºèªãã ã•ã„ã€‚'
            }
        };
        
        const currentSEO = seoData[currentLang] || seoData['kr'];
        
        // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
        document.title = currentSEO.title;
        
        // ë©”íƒ€ íƒœê·¸ ì—…ë°ì´íŠ¸
        const metaDescription = document.querySelector('meta[name="description"]');
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDescription = document.querySelector('meta[property="og:description"]');
        
        if (metaDescription) metaDescription.setAttribute('content', currentSEO.description);
        if (ogTitle) ogTitle.setAttribute('content', currentSEO.title);
        if (ogDescription) ogDescription.setAttribute('content', currentSEO.description);
    }

    // ê³„ì‹œ ìŠ¤íƒ¯ i18n ë° ë°ì´í„°
    const revI18n = {
        kr: {
            stats_title: 'ê³„ì‹œ ìŠ¤íƒ¯',
            main_title: 'ë©”ì¸ ìŠ¤íƒ¯',
            sub_title: 'ë¶€ ìŠ¤íƒ¯',
            col_option: 'ì˜µì…˜', col_min: 'ìµœì†Œ (LV1)', col_max: 'ìµœëŒ€ (LV25)',
            col_1st: '1st', col_2nd: '2nd', col_3rd: '3rd', col_4th: '4th', col_5th: '5th',
            tabs: { uni: 'ì£¼', sun: 'ì¼', moon: 'ì›”', star: 'ì„±', planet: 'ì§„' },
        },
        en: {
            stats_title: 'Revelation Stats',
            main_title: 'Main Stats',
            sub_title: 'Sub Stats',
            col_option: 'Option', col_min: 'Min (LV1)', col_max: 'Max (LV25)',
            col_1st: '1st', col_2nd: '2nd', col_3rd: '3rd', col_4th: '4th', col_5th: '5th',
            tabs: { uni: 'Universe', sun: 'Sun', moon: 'Moon', star: 'Star', planet: 'Planet' },
        },
        jp: {
            stats_title: 'å•“ç¤ºã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
            main_title: 'ãƒ¡ã‚¤ãƒ³ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
            sub_title: 'ã‚µãƒ–ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹',
            col_option: 'ã‚ªãƒ—ã‚·ãƒ§ãƒ³', col_min: 'æœ€å° (LV1)', col_max: 'æœ€å¤§ (LV25)',
            col_1st: '1st', col_2nd: '2nd', col_3rd: '3rd', col_4th: '4th', col_5th: '5th',
            tabs: { uni: 'å®™', sun: 'æ—­', moon: 'æœˆ', star: 'æ˜Ÿ', planet: 'å¤©' },
        }
    };

    // Sub stats values sourced from the article (KR/EN/JP identical numerically)
    let subStatsData = {
        universe: [
            ['Crit Rate','2.6%','2.3%','2.1%','1.8%','1.6%'],
            ['Crit Mult.','5.2%','4.7%','4.1%','3.6%','3.1%'],
            ['Pierce Rate','2.7%','2.5%','2.2%','1.8%','1.6%'],
            ['Attack Mult.','3.5%','3.1%','2.6%','2.2%','1.8%'],
            ['Attack %','4.3%','3.9%','3.5%','3.1%','2.6%'],
            ['Attack','/','/','/','/','/'],
            ['HP %','4.4%','4.0%','3.5%','3.2%','2.7%'],
            ['HP','175','157','140','123','105'],
            ['Defense %','6.4%','5.8%','5.2%','4.5%','3.8%'],
            ['Defense','/','/','/','/','/'],
            ['Ailment Accuracy','5.2%','4.7%','4.1%','3.6%','3.1%'],
            ['SP Recovery','12.5%','11.2%','10.0%','8.7%','7.5%'],
            ['Speed','2.8','2.5','2.2','1.9','1.6'],
        ],
        universal: [ // Sun/Moon/Star/Planet
            ['Crit Rate','2%','1.8%','1.7%','1.4%','1.3%'],
            ['Crit Mult.','4.1%','3.7%','3.4%','2.8%','2.5%'],
            ['Pierce Rate','2.1%','1.9%','1.7%','1.4%','1.3%'],
            ['Attack Mult.','2.8%','2.5%','2.1%','1.9%','1.7%'],
            ['Attack %','3.5%','3.2%','2.8%','2.5%','2.0%'],
            ['Attack','46','41','37','32','27'],
            ['HP %','3.6%','3.3%','2.9%','2.6%','2.1%'],
            ['HP','140','126','112','98','84'],
            ['Defense %','5.2%','4.6%','4.1%','3.5%','3.0%'],
            ['Defense','46','41','37','32','27'],
            ['Ailment Accuracy','4.1%','3.7%','3.4%','2.8%','2.5%'],
            ['SP Recovery','10.0%','9.0%','7.9%','7.0%','5.9%'],
            ['Speed','2.2','2','1.8','1.5','1.3'],
        ]
    };

    // Translation maps for sub stat names per language
    const subLabelMap = {
        kr: {
            'Crit Rate':'í¬ë¦¬í‹°ì»¬ í™•ë¥ ','Crit Mult.':'í¬ë¦¬í‹°ì»¬ íš¨ê³¼','Pierce Rate':'ê´€í†µ','Attack Mult.':'ëŒ€ë¯¸ì§€ ë³´ë„ˆìŠ¤',
            'Attack %':'ê³µê²©ë ¥%','Attack':'ê³µê²©ë ¥','HP %':'ìƒëª…%','HP':'ìƒëª…','Defense %':'ë°©ì–´ë ¥%','Defense':'ë°©ì–´ë ¥',
            'Ailment Accuracy':'íš¨ê³¼ ëª…ì¤‘','SP Recovery':'SPíšŒë³µ','Speed':'ì†ë„'
        },
        en: {},
        jp: {
            'Crit Rate':'CRTç™ºç”Ÿç‡','Crit Mult.':'CRTå€ç‡','Pierce Rate':'è²«é€š','Attack Mult.':'æ”»æ’ƒå€ç‡+','Attack %':'æ”»æ’ƒåŠ›%',
            'Attack':'æ”»æ’ƒåŠ›','HP %':'HP%','HP':'HP','Defense %':'é˜²å¾¡åŠ›%','Defense':'é˜²å¾¡åŠ›','Ailment Accuracy':'çŠ¶æ…‹ç•°å¸¸å‘½ä¸­',
            'SP Recovery':'SPå›å¾©','Speed':'é€Ÿã•'
        }
    };

    // Placeholder main stats ranges (fill exact values later from image)
    let mainStatsData = {
        kr: {
            uni: [ ['ê³µê²©ë ¥','â€”','â€”'], ['ë°©ì–´ë ¥','â€”','â€”'] ],
            sun: [ ['ìƒëª…','â€”','â€”'] ],
            moon: [ ['ê³µê²©ë ¥','â€”','â€”'], ['ëŒ€ë¯¸ì§€ ë³´ë„ˆìŠ¤','â€”','â€”'], ['ìƒëª…','â€”','â€”'], ['ë°©ì–´ë ¥','â€”','â€”'], ['ì¹˜ë£Œ íš¨ê³¼','â€”','â€”'] ],
            star: [ ['í¬ë¦¬í‹°ì»¬ í™•ë¥ ','â€”','â€”'], ['í¬ë¦¬í‹°ì»¬ íš¨ê³¼','â€”','â€”'], ['ìƒëª…','â€”','â€”'], ['ê³µê²©ë ¥','â€”','â€”'], ['ë°©ì–´ë ¥','â€”','â€”'], ['íš¨ê³¼ ëª…ì¤‘','â€”','â€”'] ].slice(0,5),
            planet: [ ['ê³µê²©ë ¥','â€”','â€”'], ['ë°©ì–´ë ¥','â€”','â€”'], ['ìƒëª…','â€”','â€”'], ['SP íšŒë³µ','â€”','â€”'], ['ì†ë„','â€”','â€”'] ],
        },
        en: {
            uni: [ ['Attack','â€”','â€”'], ['Defense','â€”','â€”'] ],
            sun: [ ['HP','â€”','â€”'] ],
            moon: [ ['Attack','â€”','â€”'], ['Attack Mult.','â€”','â€”'], ['HP','â€”','â€”'], ['Defense','â€”','â€”'], ['Healing Effect','â€”','â€”'] ],
            star: [ ['Crit Rate','â€”','â€”'], ['Crit Mult.','â€”','â€”'], ['HP','â€”','â€”'], ['Attack','â€”','â€”'], ['Defense','â€”','â€”'] ],
            planet: [ ['Attack','â€”','â€”'], ['Defense','â€”','â€”'], ['HP','â€”','â€”'], ['SP Recovery','â€”','â€”'], ['Speed','â€”','â€”'] ],
        },
        jp: {
            uni: [ ['æ”»æ’ƒåŠ›','â€”','â€”'], ['é˜²å¾¡åŠ›','â€”','â€”'] ],
            sun: [ ['HP','â€”','â€”'] ],
            moon: [ ['æ”»æ’ƒåŠ›','â€”','â€”'], ['æ”»æ’ƒå€ç‡+','â€”','â€”'], ['HP','â€”','â€”'], ['é˜²å¾¡åŠ›','â€”','â€”'], ['HPå›å¾©é‡','â€”','â€”'] ],
            star: [ ['CRTç™ºç”Ÿç‡','â€”','â€”'], ['CRTå€ç‡','â€”','â€”'], ['HP','â€”','â€”'], ['æ”»æ’ƒåŠ›','â€”','â€”'], ['é˜²å¾¡åŠ›','â€”','â€”'] ],
            planet: [ ['æ”»æ’ƒåŠ›','â€”','â€”'], ['é˜²å¾¡åŠ›','â€”','â€”'], ['HP','â€”','â€”'], ['SPå›å¾©','â€”','â€”'], ['é€Ÿã•','â€”','â€”'] ],
        }
    }

    // Helper: determine if a main stat label should be pink-highlighted for a given tab and language
    function isRevPinkLabel(lang, slotKey, label) {
        const L = lang || 'kr';
        const K = slotKey || '';
        const maps = {
            kr: {
                moon: new Set(['ëŒ€ë¯¸ì§€ ë³´ë„ˆìŠ¤', 'ì¹˜ë£Œ íš¨ê³¼']),
                star: new Set(['í¬ë¦¬í‹°ì»¬ í™•ë¥ ', 'í¬ë¦¬í‹°ì»¬ íš¨ê³¼', 'íš¨ê³¼ ëª…ì¤‘']),
                planet: new Set(['SP íšŒë³µ', 'ì†ë„'])
            },
            en: {
                moon: new Set(['Attack Mult.', 'Healing Effect']),
                star: new Set(['Crit Rate', 'Crit Mult.', 'Ailment Accuracy']),
                planet: new Set(['SP Recovery', 'Speed'])
            },
            jp: {
                moon: new Set(['æ”»æ’ƒå€ç‡+', 'HPå›å¾©é‡']),
                star: new Set(['CRTç™ºç”Ÿç‡', 'CRTå€ç‡', 'çŠ¶æ…‹ç•°å¸¸å‘½ä¸­']),
                planet: new Set(['SPå›å¾©', 'é€Ÿã•'])
            }
        };
        const dict = maps[L] || maps.kr;
        const set = dict[K];
        return !!(set && set.has(label));
    }

    function renderMainTable(lang, slotKey) {
        const i18n = revI18n[lang] || revI18n.kr;
        const rows = (mainStatsData[lang] || mainStatsData.kr)[slotKey] || [];
        const header = `<div class="rev-subsection-title">${i18n.main_title}</div>`;
        // Show bigger values first (Max -> Min)
        const table = [`<div class="rev-table-wrap"><table class="rev-table rev-table-main"><thead><tr><th>${i18n.col_option}</th><th>${i18n.col_max}</th><th>${i18n.col_min}</th></tr></thead><tbody>`,
            ...rows.map(r=>{
                const pink = isRevPinkLabel(lang, slotKey, r[0]);
                const label = pink ? `<span class="rev-label-pink">${r[0]}</span>` : r[0];
                return `<tr><td>${label}</td><td>${r[2]}</td><td>${r[1]}</td></tr>`;
            }),
            `</tbody></table></div>`].join('');
        return header + table;
    }

    // Load stats JSON from same app folder
    async function loadRevStatsData(){
        const url = '/apps/revelations/revelation_stats.json';
        try{
            const res = await fetch(url, { cache: 'no-cache' });
            if(!res.ok) throw new Error('HTTP '+res.status);
            const json = await res.json();
            if (json && json.sub_stats) subStatsData = json.sub_stats;
            if (json && json.main_stats) mainStatsData = json.main_stats;
        }catch(err){
            console.warn('Revelation stats JSON load failed, using fallback:', err);
        }
    }

    function renderSubTable(lang, group) {
        const i18n = revI18n[lang] || revI18n.kr;
        const data = group === 'universal' ? subStatsData.universal : subStatsData.universe;
        const map = subLabelMap[lang] || {};
        const header = `<div class="rev-subsection-title">${i18n.sub_title}</div>`;
        const head = `<thead><tr><th>${i18n.col_option}</th><th>${i18n.col_1st}</th><th>${i18n.col_2nd}</th><th>${i18n.col_3rd}</th><th>${i18n.col_4th}</th><th>${i18n.col_5th}</th></tr></thead>`;
        const body = data.map(row=>{
            const label = map[row[0]] || row[0];
            return `<tr><td>${label}</td><td>${row[1]}</td><td>${row[2]}</td><td>${row[3]}</td><td>${row[4]}</td><td>${row[5]}</td></tr>`;
        }).join('');
        return header + `<div class="rev-table-wrap"><table class="rev-table rev-table-sub">${head}<tbody>${body}</tbody></table></div>`;
    }

    function buildRevStatsUI(currentLang){
        const lang = currentLang || (typeof LanguageRouter!== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr');
        const i18n = revI18n[lang] || revI18n.kr;

        const titleEl = document.getElementById('rev-stats-title');
        if (titleEl) titleEl.textContent = i18n.stats_title;

        // Update tab labels for i18n
        const tabMap = { uni: '.tab-text-uni', sun: '.tab-text-sun', moon: '.tab-text-moon', star: '.tab-text-star', planet: '.tab-text-planet' };
        Object.entries(tabMap).forEach(([k, sel])=>{
            const el = document.querySelector(sel);
            if (el) el.textContent = i18n.tabs[k];
        });

        // Fill panels
        const panels = {
            uni: document.querySelector('.rev-tab-panel[data-panel="uni"]'),
            sun: document.querySelector('.rev-tab-panel[data-panel="sun"]'),
            moon: document.querySelector('.rev-tab-panel[data-panel="moon"]'),
            star: document.querySelector('.rev-tab-panel[data-panel="star"]'),
            planet: document.querySelector('.rev-tab-panel[data-panel="planet"]'),
        };

        if (panels.uni) panels.uni.innerHTML = renderMainTable(lang,'uni') + renderSubTable(lang,'universe');
        if (panels.sun) panels.sun.innerHTML = renderMainTable(lang,'sun') + renderSubTable(lang,'universal');
        if (panels.moon) panels.moon.innerHTML = renderMainTable(lang,'moon') + renderSubTable(lang,'universal');
        if (panels.star) panels.star.innerHTML = renderMainTable(lang,'star') + renderSubTable(lang,'universal');
        if (panels.planet) panels.planet.innerHTML = renderMainTable(lang,'planet') + renderSubTable(lang,'universal');

        // Events
        const accBtn = document.getElementById('rev-accordion-btn');
        const panel = document.getElementById('rev-panel');
        if (accBtn && panel && !accBtn.dataset.bound){
            accBtn.addEventListener('click',()=>{
                const open = panel.style.display !== 'none';
                panel.style.display = open ? 'none' : 'block';
                accBtn.classList.toggle('open', !open);
            });
            accBtn.dataset.bound = '1';
        }
        document.querySelectorAll('.rev-tab').forEach(btn=>{
            if (btn.dataset.bound) return;
            btn.addEventListener('click',()=>{
                document.querySelectorAll('.rev-tab').forEach(b=>b.classList.remove('active'));
                btn.classList.add('active');
                const key = btn.getAttribute('data-tab');
                document.querySelectorAll('.rev-tab-panel').forEach(p=>p.style.display='none');
                const target = document.querySelector(`.rev-tab-panel[data-panel="${key}"]`);
                if (target) target.style.display = 'block';
            });
            btn.dataset.bound = '1';
        });
    }

    // Initialize navigation on page load
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            // í˜„ì¬ ì–¸ì–´ í™•ì¸
            const currentLang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
            
            // ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
            if (typeof Navigation !== 'undefined') {
                Navigation.load('revelations', 1);
            }
            
            if (typeof VersionChecker !== 'undefined') {
                VersionChecker.check();
            }

            // SEO ì„¤ì • ì—…ë°ì´íŠ¸
            updateSEOContent();
            
            // ë°ì´í„° ë¡œë“œ
            await loadLanguageData(currentLang);
            // ìºë¦­í„° ë°ì´í„° ë¡œë“œ
            await loadCharacterData();
            // Load external stats JSON (non-blocking for rest of page build)
            await loadRevStatsData();
            
            // ì–¸ì–´ ì½˜í…ì¸  ì—…ë°ì´íŠ¸
            await updateLanguageContent();
            
            // í˜ì´ì§€ ì´ˆê¸°í™”
            initializePageContent();
            // Build Revelation Stats UI (after language is ready)
            buildRevStatsUI(currentLang);
            
        } catch (error) {
            console.error('Failed to load language data:', error);
            // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = 'ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.';
            document.querySelector('.main-wrapper').prepend(errorDiv);
        }
    });

    // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” revelation ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
    function getCurrentRevelationData() {
        const currentLang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        let data = null;
        switch (currentLang) {
            case 'en':
                data = window.enRevelationData || (typeof enRevelationData !== 'undefined' ? enRevelationData : null);
                break;
            case 'jp':
                data = window.jpRevelationData || (typeof jpRevelationData !== 'undefined' ? jpRevelationData : null);
                break;
            default:
                data = window.revelationData || (typeof revelationData !== 'undefined' ? revelationData : null);
        }
        
        // ë°ì´í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ revelationData ì‚¬ìš©
        return data || window.revelationData || (typeof revelationData !== 'undefined' ? revelationData : {main: {}, sub: {}, sub_effects: {}, set_effects: {}});
    }

    function initializePageContent() {
        const cardsContainer = document.getElementById('revelationCards');
        const searchCount = document.querySelector('.search-count');
        
        // í˜„ì¬ ì–¸ì–´ í™•ì¸
        const currentLang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        const currentRevelationData = getCurrentRevelationData();
        
        // ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬
        if (!currentRevelationData || !currentRevelationData.main || !currentRevelationData.sub) {
            console.error('Revelation data not loaded properly:', currentRevelationData);
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = 'ê³„ì‹œ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.';
            cardsContainer.appendChild(errorDiv);
            return;
        }
        
        // Build stats UI in case language finished after
        try { buildRevStatsUI(); } catch(e) { /* noop */ }

        // Separate main revelations and sub revelations
        const mainRevelations = Object.keys(currentRevelationData.main);
        const subRevelations = Object.keys(currentRevelationData.sub);
        
        // Function to check if a revelation is unreleased
        const isUnreleased = (revelation) => {
            if (currentLang === 'kr') return false;
            
            if (revelation.type === 'sub') {
                const effects = currentRevelationData.sub_effects && currentRevelationData.sub_effects[revelation.name];
                return effects && effects.type && effects.type.includes('ë¯¸ì¶œì‹œ');
            } else {
                const mainEffects = currentRevelationData.set_effects && currentRevelationData.set_effects[revelation.name];
                return mainEffects && mainEffects.type && mainEffects.type.includes('ë¯¸ì¶œì‹œ');
            }
        };

        // Create array of all revelations (sub revelations first, then main revelations)
        // and sort to put unreleased items at the end of their respective sections
        const allRevelations = [
            // Sub revelations - unreleased at the end
            ...subRevelations
                .map(name => ({ name, type: 'sub' }))
                .sort((a, b) => {
                    const aUnreleased = isUnreleased(a);
                    const bUnreleased = isUnreleased(b);
                    if (aUnreleased && !bUnreleased) return 1;
                    if (!aUnreleased && bUnreleased) return -1;
                    return 0;
                }),
            // Main revelations - unreleased at the end
            ...mainRevelations
                .map(name => ({ name, type: 'main' }))
                .sort((a, b) => {
                    const aUnreleased = isUnreleased(a);
                    const bUnreleased = isUnreleased(b);
                    if (aUnreleased && !bUnreleased) return 1;
                    if (!aUnreleased && bUnreleased) return -1;
                    return 0;
                })
        ];
        
        // ì´ˆê¸° ê²€ìƒ‰ ê²°ê³¼ ìˆ˜ í‘œì‹œ
        const countText = window.i18nFilteredCount || 'ì „ì²´';
        const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
        searchCount.textContent = `${countText} ${allRevelations.length}${countUnit}`;
        
        // Create card for each revelation
        allRevelations.forEach((revelation, index) => {
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.type = revelation.type;
            card.dataset.name = revelation.name;
            
            // Get Korean name for image path (using reverse mapping)
            let koreanName = revelation.name;
            
            // If not Korean, find Korean name from mapping
            if (currentLang !== 'kr') {
                if (currentLang === 'jp' && currentRevelationData.mapping_jp) {
                    // Find Korean name from Japanese mapping
                    const koreanKey = Object.keys(currentRevelationData.mapping_jp).find(key => 
                        currentRevelationData.mapping_jp[key] === revelation.name
                    );
                    if (koreanKey) koreanName = koreanKey;
                } else if (currentLang === 'en' && currentRevelationData.mapping_en) {
                    // Find Korean name from English mapping
                    const koreanKey = Object.keys(currentRevelationData.mapping_en).find(key => 
                        currentRevelationData.mapping_en[key] === revelation.name
                    );
                    if (koreanKey) koreanName = koreanKey;
                }
            }
            // If Korean, koreanName is already correct (revelation.name)
            
            // Image container
            const imgContainer = document.createElement('div');
            imgContainer.className = 'img-container';
            
            // Revelation image - use Korean name for file path
            const img = document.createElement('img');
            img.src = `{{ site.baseurl }}/assets/img/revelation/${koreanName}.webp`;
            img.alt = revelation.name;
            img.className = 'revelation-img';

            // Name image - use Korean name for file path
            const nameImg = document.createElement('img');
            nameImg.src = `{{ site.baseurl }}/assets/img/revelation/${koreanName}.png`;
            nameImg.alt = revelation.name;
            nameImg.className = 'name-img';
            
            imgContainer.appendChild(img);
            
            if(currentLang == 'kr') {
                imgContainer.appendChild(nameImg);
            }
            
            // Info container
            const infoContainer = document.createElement('div');
            infoContainer.className = 'info-container';
            
            // Type label
            const typeLabel = document.createElement('div');
            typeLabel.className = 'type-label';
            
            // Container for text and icons
            const typeLabelContent = document.createElement('div');
            typeLabelContent.className = 'type-label-content';
            
            // Add text
            const typeText = document.createElement('span');
            typeText.textContent = revelation.name;  // Changed to revelation name
            
            // Icon container
            const iconContainer = document.createElement('div');
            iconContainer.className = 'type-icons';
            
            if (revelation.type === 'main') {
                // For main revelations
                const mainIcon = document.createElement('img');
                mainIcon.src = '{{ site.baseurl }}/assets/img/revelation/icon-ì£¼.png';
                mainIcon.alt = 'ì£¼';
                mainIcon.className = 'type-icon';
                iconContainer.appendChild(mainIcon);
            } else {
                // For sub revelations
                ['ì¼', 'ì›”', 'ì„±', 'ì§„'].forEach(type => {
                    const icon = document.createElement('img');
                    icon.src = `{{ site.baseurl }}/assets/img/revelation/icon-${type}.png`;
                    icon.alt = type;
                    icon.className = 'type-icon';
                    iconContainer.appendChild(icon);
                });
            }
            
            typeLabelContent.appendChild(typeText);
            typeLabelContent.appendChild(iconContainer);
            
            // Add "not released" indicator for unreleased revelations in EN/JP
            if (currentLang !== 'kr' && isUnreleased(revelation)) {
                const notReleasedLabel = document.createElement('div');
                notReleasedLabel.className = 'not-released-label';
                notReleasedLabel.textContent = currentLang === 'en' ? 'Not Released' : 'ãƒªãƒªãƒ¼ã‚¹å‰';
                typeLabelContent.appendChild(notReleasedLabel);
            }
            typeLabel.appendChild(typeLabelContent);
            
            // Effect description
            const effectsContainer = document.createElement('div');
            effectsContainer.className = 'effects-container';
            
            if (revelation.type === 'sub') {
                // For sub revelations, show 2-set and 4-set effects
                const effects = currentRevelationData.sub_effects && currentRevelationData.sub_effects[revelation.name];
                if (effects) {
                    const setLabel2 = window.i18nSetEffect2 || '2ì„¸íŠ¸';
                    const setLabel4 = window.i18nSetEffect4 || '4ì„¸íŠ¸';
                    
                    effectsContainer.innerHTML = `
                        <div class="effect-set">
                            <div class="set-label">${setLabel2}</div>
                            <div class="set-desc">${effects.set2 || ''}</div>
                        </div>
                        <div class="effect-set">
                            <div class="set-label">${setLabel4}</div>
                            <div class="set-desc">${effects.set4 || ''}</div>
                        </div>
                    `;
                }
            } else {
                // For main revelations, show set_effects
                const mainEffects = currentRevelationData.set_effects && currentRevelationData.set_effects[revelation.name];
                if (mainEffects) {
                    // subNameì´ typeì´ ì•„ë‹Œ ê²ƒë“¤ë§Œ
                    effectsContainer.innerHTML = Object.entries(mainEffects)
                        .filter(([subName]) => subName !== 'type')
                        .map(([subName, effect]) => {
                            return `
                            <div class="effect-set">
                                <div class="set-label">${subName}</div>
                                <div class="set-desc">${effect}</div>
                            </div>
                        `;
                        }).join('');
                }
            }
            
            infoContainer.appendChild(typeLabel);
            infoContainer.appendChild(effectsContainer);

            // ---- Characters Accordion ----
            // i18n label
            const tLabel = (function(){
                const lang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
                const map = {
                    kr: 'ì‚¬ìš© ìºë¦­í„°',
                    en: 'Characters',
                    jp: 'ä½¿ç”¨ã‚­ãƒ£ãƒ©'
                };
                // prefer i18nData if available
                try {
                    const tdata = (window.i18nSetEffect2 !== undefined) ? null : null; // no-op, ensure no crash
                } catch (e) {}
                return (lang==='en'? 'Characters' : (lang==='jp'? 'ä½¿ç”¨ã‚­ãƒ£ãƒ©' : 'ì‚¬ìš© ìºë¦­í„°'));
            })();

            // Helpers
            function getCharacterLabel(koreanCharName, lang) {
                const c = (typeof characterData !== 'undefined') ? characterData[koreanCharName] : null;
                if (!c) return koreanCharName;
                if (lang === 'en' && c.codename) return c.codename;
                if (lang === 'jp' && c.name_jp) return c.name_jp;
                return koreanCharName;
            }
            function findUsersOfRevelation(koreanRevName) {
                if (typeof characterData === 'undefined') return [];
                const users = [];
                Object.entries(characterData).forEach(([charName, c]) => {
                    const mains = Array.isArray(c.main_revelation) ? c.main_revelation : [];
                    const subs = Array.isArray(c.sub_revelation) ? c.sub_revelation : [];
                    if (mains.includes(koreanRevName) || subs.includes(koreanRevName)) {
                        users.push(charName);
                    }
                });
                // sort by name
                users.sort((a,b)=>a.localeCompare(b,'ko'));
                return users;
            }

            const accordion = document.createElement('div');
            accordion.className = 'accordion';
            const header = document.createElement('div');
            header.className = 'accordion-header';
            header.setAttribute('aria-expanded','false');
            header.innerHTML = `<span>${tLabel}</span><span>+</span>`;
            const content = document.createElement('div');
            content.className = 'accordion-content';

            const users = findUsersOfRevelation(koreanName);
            if (users.length) {
                const grid = document.createElement('div');
                grid.className = 'user-list';
                const lang = (typeof LanguageRouter !== 'undefined' && LanguageRouter) ? LanguageRouter.getCurrentLanguage() : 'kr';
                users.forEach(u => {
                    const a = document.createElement('a');
                    a.className = 'character-link';
                    a.href = `/character.html?name=${encodeURIComponent(u)}`;

                    const cimg = document.createElement('img');
                    cimg.className = 'character-img';
                    cimg.src = `{{ site.baseurl }}/assets/img/tier/${u}.webp`;
                    cimg.alt = u;
                    cimg.loading = 'lazy';
                    cimg.onerror = function() { this.onerror = null; this.src = `{{ site.baseurl }}/assets/img/character-half/${u}.webp`; };

                    const icons = document.createElement('span');
                    icons.className = 'char-icons';
                    const cdata = (typeof characterData !== 'undefined') ? characterData[u] : null;
                    const pos = cdata && cdata.position ? cdata.position : '';
                    const ele = cdata && cdata.element ? cdata.element : '';
                    if (pos) {
                        const pi = document.createElement('img');
                        pi.src = `{{ site.baseurl }}/assets/img/character-cards/ì§ì—…_${pos}.png`;
                        pi.alt = pos;
                        pi.loading = 'lazy';
                        pi.className = 'char-icon';
                        icons.appendChild(pi);
                    }
                    if (ele) {
                        const ei = document.createElement('img');
                        ei.src = `{{ site.baseurl }}/assets/img/character-cards/ì†ì„±_${ele}.png`;
                        ei.alt = ele;
                        ei.loading = 'lazy';
                        ei.className = 'char-icon';
                        icons.appendChild(ei);
                    }

                    const label = document.createElement('span');
                    label.className = 'character-name';
                    label.textContent = getCharacterLabel(u, lang);

                    a.appendChild(cimg);
                    a.appendChild(icons);
                    a.appendChild(label);
                    grid.appendChild(a);
                });
                content.appendChild(grid);
            } else {
                content.textContent = '-';
            }

            // Toggle on card click (ignore interactive elements)
            card.addEventListener('click', (e) => {
                const target = e.target;
                if (target.closest('a') || target.closest('button')) return;
                const isOpen = content.classList.toggle('open');
                header.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
                header.lastElementChild.textContent = isOpen ? 'âˆ’' : '+';
                card.classList.toggle('active', isOpen);
            });

            // Also allow toggling by clicking the accordion header directly
            header.addEventListener('click', (e) => {
                e.stopPropagation();
                const isOpen = content.classList.toggle('open');
                header.setAttribute('aria-expanded', isOpen ? 'true' : 'false');
                header.lastElementChild.textContent = isOpen ? 'âˆ’' : '+';
                card.classList.toggle('active', isOpen);
            });

            accordion.appendChild(header);
            accordion.appendChild(content);
            infoContainer.appendChild(accordion);
            
            card.appendChild(imgContainer);
            card.appendChild(infoContainer);
            cardsContainer.appendChild(card);
        });
        
        addTooltips();

        // Add filtering functionality
        const checkboxes = document.querySelectorAll('.filter-options input[type="checkbox"]');
        
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                applyFilters();
            });
        });

        function applyFilters() {
            const selectedTypes = Array.from(document.querySelectorAll('input[name="type"]:checked')).map(cb => cb.value);
            const selectedElements = Array.from(document.querySelectorAll('input[name="element"]:checked')).map(cb => cb.value);
            const selectedEffects = Array.from(document.querySelectorAll('input[name="effect"]:checked')).map(cb => cb.value);
            
            const cards = document.querySelectorAll('.card');
            let visibleCount = 0;
            
            // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const currentRevelationData = getCurrentRevelationData();
            
            // List of filtered sub revelations
            let filteredSubRevelations = [];
            if (currentRevelationData.sub_effects) {
                filteredSubRevelations = Object.entries(currentRevelationData.sub_effects).filter(([name, effects]) => {
                    const elementMatch = selectedElements.length === 0 || 
                        (effects.type && selectedElements.some(element => effects.type.includes(element)));
                    const effectMatch = selectedEffects.length === 0 || 
                        (effects.type && selectedEffects.some(effect => effects.type.includes(effect)));
                    return elementMatch && effectMatch;
                }).map(([name]) => name);
            }

            // Find main revelations related to filtered sub revelations
            let relatedMainRevelations = new Set();
            if (currentRevelationData.main) {
                Object.entries(currentRevelationData.main).forEach(([mainName, subNames]) => {
                    if (Array.isArray(subNames) && subNames.some(subName => filteredSubRevelations.includes(subName))) {
                        relatedMainRevelations.add(mainName);
                    }
                });
            }

            cards.forEach(card => {
                const type = card.dataset.type;
                const name = card.dataset.name;
                
                const typeMatch = selectedTypes.length === 0 || selectedTypes.includes(type);
                const nameMatch = type === 'sub' ? 
                    filteredSubRevelations.includes(name) : 
                    relatedMainRevelations.has(name);
                
                if (typeMatch && nameMatch) {
                    card.style.display = 'flex';
                    card.style.visibility = 'visible';
                    card.style.opacity = '1';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                    card.style.visibility = 'hidden';
                    card.style.opacity = '0';
                }
            });
            
            // Update search count
            const countText = window.i18nFilteredCount || 'ì „ì²´';
            const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
            searchCount.textContent = `${countText} ${visibleCount}${countUnit}`;
        }

        // Search functionality implementation
        const searchInput = document.getElementById('revelationSearch');
        const dropdown = document.getElementById('searchDropdown');
        const cards = document.querySelectorAll('.card');

        searchInput.addEventListener('input', (e) => {
            const searchValue = e.target.value.toLowerCase();
            dropdown.innerHTML = '';
            
            // Dropdown autocomplete handling
            if (searchValue.length > 0) {
                const matches = allRevelations.filter(revelation => {
                    const revelationName = revelation.name.toLowerCase();
                    return revelationName.includes(searchValue);
                });

                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                    matches.forEach(revelation => {
                        const div = document.createElement('div');
                        div.className = 'dropdown-item';
                        div.textContent = revelation.name;
                        div.addEventListener('click', () => {
                            searchInput.value = revelation.name;
                            dropdown.style.display = 'none';
                            filterBySearch(revelation.name.toLowerCase());
                        });
                        dropdown.appendChild(div);
                    });
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
                filterBySearch('');
            }

            // Filter by search term
            filterBySearch(searchValue);
        });

        // Search filtering function
        function filterBySearch(searchValue) {
            let visibleCount = 0;
            
            cards.forEach(card => {
                const name = card.dataset.name;
                const shouldShow = searchValue === '' || name.toLowerCase().includes(searchValue);
                
                if (shouldShow) {
                    card.style.display = 'flex';
                    card.style.visibility = 'visible';
                    card.style.opacity = '1';
                    visibleCount++;
                } else {
                    card.style.display = 'none';
                    card.style.visibility = 'hidden';
                    card.style.opacity = '0';
                }
            });
            
            // Update search count
            const countText = window.i18nFilteredCount || 'ì „ì²´';
            const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
            searchCount.textContent = `${countText} ${visibleCount}${countUnit}`;
        }

        let activeCard = null; // Track currently active card

        // Handle card click events
        cards.forEach(card => {
            card.addEventListener('click', (e) => {
                e.stopPropagation(); // Prevent event bubbling
                const clickedName = card.getAttribute('data-name');
                const cardType = card.getAttribute('data-type');

                if (activeCard === card) {
                    // If clicking the same card again, remove filter
                    deactivateFilter();
                } else {
                    // If clicking a different card, apply filter
                    activateFilter(card, clickedName, cardType);
                }
            });
        });

        function activateFilter(card, name, type) {
            if (activeCard) {
                activeCard.classList.remove('active');
            }

            activeCard = card;
            card.classList.add('active');

            // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const currentRevelationData = getCurrentRevelationData();

            let relatedRevelations = [];
            if (type === 'main' && currentRevelationData.main) {
                // For main revelations, get all connected sub revelations
                relatedRevelations = currentRevelationData.main[name] || [];
                relatedRevelations.push(name);
            } else if (type === 'sub' && currentRevelationData.main) {
                // For sub revelations, find all main revelations that include this sub revelation
                Object.entries(currentRevelationData.main).forEach(([mainName, subNames]) => {
                    if (Array.isArray(subNames) && subNames.includes(name)) {
                        relatedRevelations.push(mainName);
                    }
                });
                relatedRevelations.push(name);
            }

            let visibleCount = 0;
            cards.forEach(c => {
                const cardName = c.getAttribute('data-name');
                const shouldShow = relatedRevelations.includes(cardName);

                if (shouldShow) {
                    c.style.display = 'flex';
                    c.style.visibility = 'visible';
                    c.style.opacity = '1';
                    visibleCount++;
                } else {
                    c.style.display = 'none';
                    c.style.visibility = 'hidden';
                    c.style.opacity = '0';
                }
            });

            // Update search count for related revelations
            const countText = window.i18nFilteredCount || 'ì „ì²´';
            const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
            searchCount.textContent = `${countText} ${visibleCount}${countUnit}`;
        }

        function deactivateFilter() {
            // Remove active card style
            if (activeCard) {
                activeCard.classList.remove('active');
                activeCard = null;
            }

            // Show all cards
            applyFilters();
        }
    } // initializePageContent í•¨ìˆ˜ ì¢…ë£Œ
</script>


<style>
.not-released-label {
    position: absolute;
    top: 10px;
    right: -1px;
    background: #c62323;
    color: #000;
    font-size: 8px;
    font-weight: bold;
    padding: 2px 6px;
    border-radius: 0px;
    z-index: 10;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}
</style>