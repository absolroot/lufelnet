---
layout: default
custom_css: [persona]
custom_js: [tooltip, language-router]
custom_data: [wonder/persona.js, tooltip.js, wonder/skills.js]
permalink: /persona/
redirect_from: 
  - /kr/persona/
  - /kr/persona/index.html
language: kr
title : ì£¼ìš” í˜ë¥´ì†Œë‚˜ - í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ X ë£¨í˜ë¥´ë„·
description: í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ Xì˜ ì£¼ìš” í˜ë¥´ì†Œë‚˜ ì •ë³´
alternate_urls:
  en: /persona/?lang=en
  jp: /persona/?lang=jp
---

{% if page.alternate_urls %}
<link rel="alternate" hreflang="ko" href="{{ site.url }}/persona/" />
{% for lang in page.alternate_urls %}
<link rel="alternate" hreflang="{{ lang[0] }}" href="{{ site.url }}{{ lang[1] }}" />
{% endfor %}
<link rel="alternate" hreflang="x-default" href="{{ site.url }}/persona/" />
{% endif %}

<div class="main-wrapper">
    <!-- ì–¸ì–´ ì•ˆë‚´ ë©”ì‹œì§€ -->
    <div id="language-notice" class="language-notice" style="display: none;">
        <p id="language-notice-text"></p>
    </div>

    <div class="navigation-path">
        <script>document.write(`<a href="../../?v=${APP_VERSION}" id="nav-home">í™ˆ</a>`);</script>
        <span class="separator">/</span>
        <span class="current-page" id="nav-current">í˜ë¥´ì†Œë‚˜</span>
    </div>
    <div class="header-container">
        <h1 id="page-title">ì£¼ìš” í˜ë¥´ì†Œë‚˜</h1>
    </div>
    <!-- Filter section -->
    <div class="filter-section">
        <div class="filter-header">
            <button class="filter-toggle-btn">
                <img src="{{ site.baseurl }}/assets/img/character-cards/filter.png" alt="í•„í„°" />
                <span></span>
            </button>
            <button class="filter-reset-btn" style="display: none;">
                <img src="{{ site.baseurl }}/assets/img/character-cards/reset.png" alt="ì´ˆê¸°í™”" />
            </button>
        </div>
        
        <div class="filter-content" style="display: none;">
            <!-- Element filter -->
            <div class="filter-group">
                <h3>ì†ì„±</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="element" value="ë¬¼ë¦¬">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ë¬¼ë¦¬.png" alt="ë¬¼ë¦¬">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì´ê²©">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì´ê²©.png" alt="ì´ê²©">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="í™”ì—¼">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_í™”ì—¼.png" alt="í™”ì—¼">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ë¹™ê²°">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ë¹™ê²°.png" alt="ë¹™ê²°">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì „ê²©">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì „ê²©.png" alt="ì „ê²©">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì§ˆí’">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì§ˆí’.png" alt="ì§ˆí’">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì—¼ë™">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì—¼ë™.png" alt="ì—¼ë™">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="í•µì—´">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_í•µì—´.png" alt="í•µì—´">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì¶•ë³µ">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì¶•ë³µ.png" alt="ì¶•ë³µ">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ì£¼ì›">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ì£¼ì›.png" alt="ì£¼ì›">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="ë§ŒëŠ¥">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_ë§ŒëŠ¥.png" alt="ë§ŒëŠ¥">
                        <span></span>
                    </label>
                </div>
            </div>
            
            <!-- Position filter -->
            <div class="filter-group">
                <h3>ì§ì—…</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="position" value="ì§€ë°°">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_ì§€ë°°.png" alt="ì§€ë°°">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="ë°˜í•­">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_ë°˜í•­.png" alt="ë°˜í•­">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="ìš°ì›”">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_ìš°ì›”.png" alt="ìš°ì›”">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="êµ´ë³µ">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_êµ´ë³µ.png" alt="êµ´ë³µ">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="ë°©ìœ„">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_ë°©ìœ„.png" alt="ë°©ìœ„">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="êµ¬ì›">
                        <img src="{{ site.baseurl }}/assets/img/persona/ì§ì—…_êµ¬ì›.png" alt="êµ¬ì›">
                    </label>
                </div>
            </div>
            
            <!-- Rarity filter -->
            <div class="filter-group">
                <h3>í¬ê·€ë„</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="rarity" value="5" hidden>
                        <div class="star-container">
                            <img src="{{ site.baseurl }}/assets/img/persona/star5.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star5.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star5.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star5.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star5.webp" alt="â˜…">
                        </div>
                    </label>
                    <label>
                        <input type="checkbox" name="rarity" value="4" hidden>
                        <div class="star-container">
                            <img src="{{ site.baseurl }}/assets/img/persona/star4.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star4.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star4.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star4.webp" alt="â˜…">
                        </div>
                    </label>
                    <label>
                        <input type="checkbox" name="rarity" value="3" hidden>
                        <div class="star-container">
                            <img src="{{ site.baseurl }}/assets/img/persona/star3.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star3.webp" alt="â˜…">
                            <img src="{{ site.baseurl }}/assets/img/persona/star3.webp" alt="â˜…">
                        </div>
                    </label>
                </div>
            </div>

            <!-- Grade filter -->
            <div class="filter-group">
                <h3>ë“±ê¸‰</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="grade" value="1">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade1.webp" alt="1ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="2">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade2.webp" alt="2ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="3">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade3.webp" alt="3ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="4">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade4.webp" alt="4ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="5">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade5.webp" alt="5ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="6">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade6.webp" alt="6ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="7">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade7.webp" alt="7ë“±ê¸‰">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="grade" value="8">
                        <img src="{{ site.baseurl }}/assets/img/persona/persona-grade8.webp" alt="8ë“±ê¸‰">
                        <span></span>
                    </label>
                </div>
            </div>
        </div>
    </div>

    <!-- Separator line -->
    <div class="separator-line"></div>

    <!-- Search section below filter section -->
    <div class="search-section">
        <div class="search-container">
            <div class="search-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15.5 14H14.71L14.43 13.73C15.41 12.59 16 11.11 16 9.5C16 5.91 13.09 3 9.5 3C5.91 3 3 5.91 3 9.5C3 13.09 5.91 16 9.5 16C11.11 16 12.59 15.41 13.73 14.43L14 14.71V15.5L19 20.49L20.49 19L15.5 14ZM9.5 14C7.01 14 5 11.99 5 9.5C5 7.01 7.01 5 9.5 5C11.99 5 14 7.01 14 9.5C14 11.99 11.99 14 9.5 14Z" fill="rgba(255, 255, 255, 0.6)"/>
                </svg>
            </div>
            <input type="text" id="personaSearch" placeholder="í˜ë¥´ì†Œë‚˜ ê²€ìƒ‰..." autocomplete="off">
            <div id="searchDropdown" class="search-dropdown"></div>
        </div>
        <div class="search-count">
            <span id="filteredCount">ì „ì²´ 0ê°œ</span>
        </div>
    </div>

    <!-- Explain Container -->
    <div class="explain-container">
        <div class="explain-box">
            <div class="explain-section">
                <h4>ë³¸ëŠ¥ Â· ê³ ìœ  ìŠ¤í‚¬ Â· HIGHLIGHT</h4>
                <div class="priority-examples">
                    <div class="priority-label">ì¤‘ìš”ë„ :</div>
                    <div class="priority-item">
                        <div class="priority-box high"></div>
                        <span>ìƒ</span>
                    </div>
                    <div class="priority-item">
                        <div class="priority-box medium"></div>
                        <span>ì¤‘</span>
                    </div>
                    <div class="priority-item">
                        <div class="priority-box low"></div>
                        <span>í•˜</span>
                    </div>
                </div>
            </div>
            <div class="explain-section">
                <h4>ì¶”ì²œ ìŠ¤í‚¬</h4>
                <div class="priority-examples">
                    <div class="priority-label">ìš°ì„ ìˆœìœ„ :</div>
                    <div class="priority-item">
                        <div class="priority-text high" data-priority-text="high">ë†’ìŒ</div>
                    </div>
                    <div class="priority-item">
                        <div class="priority-text medium" data-priority-text="normal">ì¼ë°˜</div>
                        
                    </div>
                    <div class="priority-item">
                        <div class="priority-text low" data-priority-text="low">ë‚®ìŒ</div>
                    </div>
                    <div class="priority-item">
                        <div class="priority-text extra-low" data-priority-text="very-low">ë§¤ìš° ë‚®ìŒ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¹´ë“œ ë¦¬ìŠ¤íŠ¸ ìœ„ì— ì§ì ‘ ì‚½ì… -->
    <style>
        .reveal-ad-button {
            background-color: #221c1c;
        }

        @media (max-width: 1200px) {
            .ad-container {
                width: 100% !important;
                padding: 0px 0px !important;
                margin-top: 0px !important;
            }

            ins.adsbygoogle[data-side-rail-status="displayed"] {
                display: none !important;
            }

            .adsbygoogle {
                padding-bottom: 0 !important;
                background: transparent !important;
            }
        }

        /* ì„±ëŠ¥ ìµœì í™” ìŠ¤íƒ€ì¼ */
        .persona-detail-container {
            /* GPU ê°€ì† í™œì„±í™” */
            transform: translateZ(0);
            backface-visibility: hidden;
            will-change: auto;
            
            /* íŠ¸ëœì§€ì…˜ ë¹„í™œì„±í™”ë¡œ ì„±ëŠ¥ í–¥ìƒ */
            transition: none !important;
        }
        
        .persona-img, .card-background, .cover-star {
            /* ì´ë¯¸ì§€ ë Œë”ë§ ìµœì í™” */
            image-rendering: -webkit-optimize-contrast;
            image-rendering: crisp-edges;
        }
        
        /* ìˆ¨ê¹€ ì²˜ë¦¬ëœ ìš”ì†Œë“¤ì˜ ë ˆì´ì•„ì›ƒ ìµœì í™” */
        .persona-detail-container[style*="position: absolute"] {
            left: -9999px !important;
            top: -9999px !important;
            z-index: -1;
        }
        
        /* ìŠ¤í¬ë¡¤ ì„±ëŠ¥ ìµœì í™” */
        .persona-cards {
            contain: layout style paint;
            overflow-anchor: none;
        }
    </style>
    <!-- 
    <div class="ad-container" style="width: calc(100% - 40px); margin: 20px 0 10px 0; padding: 0px 20px; max-height: 240px; overflow: hidden; border-radius: 10px;">
      <ins class="adsbygoogle"
           style="display:block; border-radius: 10px;"
           data-ad-format="fluid"
           data-ad-layout-key="-er+5f+66-dn+4y"
           data-ad-client="ca-pub-5862324369257695"
           data-ad-slot="6110222512"></ins>
      <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
      </script>
    </div> -->

    <!-- Persona card container -->
    <div class="persona-cards" id="personaCards">
        <!-- Dynamically generated by JavaScript -->
    </div>


</div>





<script>
    // ë‹¤êµ­ì–´ ì§€ì› í•¨ìˆ˜
    async function updateLanguageContent() {
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // ë‹¤êµ­ì–´ ë°ì´í„° ì •ì˜
        const i18nData = {
            kr: {
                language_notice: "",
                nav_home: "í™ˆ",
                nav_current: "í˜ë¥´ì†Œë‚˜",
                page_title: "ì£¼ìš” í˜ë¥´ì†Œë‚˜",
                filtered_count: "ì „ì²´",
                search_placeholder: "í˜ë¥´ì†Œë‚˜ ê²€ìƒ‰...",
                filter_element: "ì†ì„±",
                filter_position: "ì§ì—…", 
                filter_rarity: "í¬ê·€ë„",
                filter_grade: "ë“±ê¸‰",
                count_unit: "ê°œ"
            },
            en: {
                language_notice: "ğŸŒ Some translations may be inaccurate.\nIt may contain content that hasn't been released yet.",
                nav_home: "Home",
                nav_current: "Personas",
                page_title: "Core Personas",
                filtered_count: "Total",
                search_placeholder: "Search personas...",
                filter_element: "Element",
                filter_position: "Position",
                filter_rarity: "Rarity", 
                filter_grade: "Grade",
                count_unit: ""
            },
            jp: {
                language_notice: "ğŸŒ ä¸€éƒ¨ã®ç¿»è¨³ãŒä¸æ­£ç¢ºãªå ´åˆãŒã‚ã‚Šã¾ã™ã€‚\nã¾ã ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¦ã„ãªã„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãŒå«ã¾ã‚Œã¦ã„ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚",
                nav_home: "ãƒ›ãƒ¼ãƒ ",
                nav_current: "ãƒšãƒ«ã‚½ãƒŠ",
                page_title: "ä¸»è¦ãƒšãƒ«ã‚½ãƒŠ",
                filtered_count: "å…¨ä½“",
                search_placeholder: "ãƒšãƒ«ã‚½ãƒŠæ¤œç´¢...",
                filter_element: "å±æ€§",
                filter_position: "è·æ¥­",
                filter_rarity: "ãƒ¬ã‚¢ãƒªãƒ†ã‚£",
                filter_grade: "ã‚°ãƒ¬ãƒ¼ãƒ‰", 
                count_unit: ""
            }
        };
        
        const data = i18nData[currentLang];
        if (!data) return;
        
        // ì–¸ì–´ ì•ˆë‚´ ë©”ì‹œì§€
        if (currentLang !== 'kr') {
            const notice = document.getElementById('language-notice');
            const noticeText = document.getElementById('language-notice-text');
            if (notice && noticeText && data.language_notice) {
                noticeText.textContent = data.language_notice;
                notice.style.display = 'block';
            }
        }
        
        // ë„¤ë¹„ê²Œì´ì…˜ ë° ì œëª© ì—…ë°ì´íŠ¸
        const navHome = document.getElementById('nav-home');
        const navCurrent = document.getElementById('nav-current');
        const pageTitle = document.getElementById('page-title');
        const searchInput = document.getElementById('personaSearch');
        
        if (navHome) navHome.textContent = data.nav_home;
        if (navCurrent) navCurrent.textContent = data.nav_current;
        if (pageTitle) pageTitle.textContent = data.page_title;
        if (searchInput) searchInput.placeholder = data.search_placeholder;
        
        // í•„í„° ë¼ë²¨ ë²ˆì—­
        const filterLabels = document.querySelectorAll('.filter-group h3');
        if (filterLabels[0]) filterLabels[0].textContent = data.filter_element;
        if (filterLabels[1]) filterLabels[1].textContent = data.filter_position;
        if (filterLabels[2]) filterLabels[2].textContent = data.filter_rarity;
        if (filterLabels[3]) filterLabels[3].textContent = data.filter_grade;
        
        // í•„í„° ì¹´ìš´íŠ¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ë¥¼ ìœ„í•œ ì „ì—­ ë³€ìˆ˜ ì„¤ì •
        window.i18nFilteredCount = data.filtered_count;
        window.i18nCountUnit = data.count_unit;

        // ì–¸ì–´ë³„ ì„¤ëª… ë°•ìŠ¤ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        updateExplainBoxTexts(currentLang);
    }

    // ì–¸ì–´ë³„ SEO ì„¤ì • í•¨ìˆ˜
    function updateSEOContent() {
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        const seoData = {
            'kr': {
                title: 'ì£¼ìš” í˜ë¥´ì†Œë‚˜ - í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ X ë£¨í˜ë¥´ë„·',
                description: 'í˜ë¥´ì†Œë‚˜5 ë” íŒ¬í…€ Xì˜ ì£¼ìš” í˜ë¥´ì†Œë‚˜ ì •ë³´. ë³¸ëŠ¥, ê³ ìœ  ìŠ¤í‚¬, ì¶”ì²œ ìŠ¤í‚¬ ì •ë³´ë¥¼ í™•ì¸í•˜ì„¸ìš”.'
            },
            'en': {
                title: 'Core Personas - Persona 5: The Phantom X LufelNet',
                description: 'Core Persona information for Persona 5: The Phantom X. Check instinct, unique skills, and recommended skills.'
            },
            'jp': {
                title: 'ä¸»è¦ãƒšãƒ«ã‚½ãƒŠ - ãƒšãƒ«ã‚½ãƒŠ5 ã‚¶ãƒ»ãƒ•ã‚¡ãƒ³ãƒˆãƒ  X LufelNet',
                description: 'ãƒšãƒ«ã‚½ãƒŠ5 ã‚¶ãƒ»ãƒ•ã‚¡ãƒ³ãƒˆãƒ  Xã®ä¸»è¦ãƒšãƒ«ã‚½ãƒŠæƒ…å ±ã€‚æœ¬èƒ½ã€å›ºæœ‰ã‚¹ã‚­ãƒ«ã€æ¨å¥¨ã‚¹ã‚­ãƒ«æƒ…å ±ã‚’ã”ç¢ºèªãã ã•ã„ã€‚'
            }
        };
        
        const currentSEO = seoData[currentLang] || seoData['kr'];
        
        // íƒ€ì´í‹€ ì—…ë°ì´íŠ¸
        document.title = currentSEO.title;
        
        // ë©”íƒ€ íƒœê·¸ ì—…ë°ì´íŠ¸
        const metaDescription = document.querySelector('meta[name="description"]');
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDescription = document.querySelector('meta[property="og:description"]');
        
        if (metaDescription) metaDescription.setAttribute('content', currentSEO.description);
        if (ogTitle) ogTitle.setAttribute('content', currentSEO.title);
        if (ogDescription) ogDescription.setAttribute('content', currentSEO.description);
    }

    // URLì—ì„œ ê²€ìƒ‰ íŒŒë¼ë¯¸í„°ë¥¼ ê°€ì ¸ì™€ì„œ ê²€ìƒ‰ì„ ì‹¤í–‰í•˜ëŠ” í•¨ìˆ˜
    function handleSearchParam() {
        const urlParams = new URLSearchParams(window.location.search);
        const searchQuery = urlParams.get('search');
        console.log("[DEBUG] search param:", searchQuery);

        if (searchQuery) {
            const searchInput = document.getElementById('personaSearch');
            console.log("[DEBUG] searchInput:", searchInput);

            if (searchInput) {
                searchInput.value = searchQuery;
                console.log("[DEBUG] Dispatching input event");
                searchInput.dispatchEvent(new Event('input', { bubbles: true }));
                // ì´ˆê¸° íŒŒë¼ë¯¸í„° ì ìš© ì‹œ ìë™ì™„ì„± ë“œë¡­ë‹¤ìš´ì€ í‘œì‹œí•˜ì§€ ì•ŠìŒ
                const dropdown = document.getElementById('searchDropdown');
                if (dropdown) dropdown.style.display = 'none';
            }
        }
    }

    document.addEventListener('DOMContentLoaded', () => {
        Navigation.load('persona');
        VersionChecker.check();

        // SEO ì„¤ì • ì—…ë°ì´íŠ¸
        updateSEOContent();

        // ì–¸ì–´ ë¼ìš°í„° ì´ˆê¸°í™” ë° ì½˜í…ì¸  ì—…ë°ì´íŠ¸
        if (typeof LanguageRouter !== 'undefined') {
            // ì´ë¯¸ ì–¸ì–´ íŒŒë¼ë¯¸í„°ê°€ ìˆê±°ë‚˜ ì§ì ‘ ì ‘ê·¼í•œ ê²½ìš° ë¦¬ë‹¤ì´ë ‰ì…˜ ì—†ì´ ì§„í–‰
            const hasLangParam = window.location.search.includes('lang=');
            if (hasLangParam) {
                console.log("HELLOHELLO")
                // ì–¸ì–´ íŒŒë¼ë¯¸í„°ê°€ ìˆìœ¼ë©´ ë°”ë¡œ ì½˜í…ì¸  ë¡œë“œ
                updateLanguageContent().then(() => {
                    initializePageContent().then(() => {
                        // ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì²˜ë¦¬ (ì§§ì€ ì§€ì—° ì¶”ê°€)
                        setTimeout(handleSearchParam, 100);
                    });
                });
            } else {
                // ì–¸ì–´ íŒŒë¼ë¯¸í„°ê°€ ì—†ìœ¼ë©´ ê¸°ë³¸ í•œêµ­ì–´ë¡œ ì„¤ì •í•˜ê³  ì½˜í…ì¸  ë¡œë“œ
                const currentUrl = new URL(window.location);
                currentUrl.searchParams.set('lang', 'kr');
                window.history.replaceState({}, '', currentUrl);
                
                updateLanguageContent().then(() => {
                    initializePageContent().then(() => {
                        // ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì²˜ë¦¬ (ì§§ì€ ì§€ì—° ì¶”ê°€)
                        setTimeout(handleSearchParam, 100);
                    });
                });
            }
        } else {
            updateLanguageContent().then(() => {
                initializePageContent().then(() => {
                    // ê²€ìƒ‰ íŒŒë¼ë¯¸í„° ì²˜ë¦¬ (ì§§ì€ ì§€ì—° ì¶”ê°€)
                    setTimeout(handleSearchParam, 100);
                });
            });
        }
    });

    async function initializePageContent() {
        const cardsContainer = document.getElementById('personaCards');
        
        // í˜„ì¬ ì–¸ì–´ í™•ì¸
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // ì–¸ì–´ë³„ ì„¤ëª… ë°•ìŠ¤ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        updateExplainBoxTexts(currentLang);
        
        // Update initial count
        const countText = window.i18nFilteredCount || 'ì „ì²´';
        const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
        document.getElementById('filteredCount').textContent = `${countText} ${Object.keys(personaData).length}${countUnit}`;

        const sortedPersonas = Object.keys(personaData)
        
        sortedPersonas.forEach((personaName, index) => {
            const detailContainer = document.createElement('div');
            detailContainer.className = 'persona-detail-container';
            // Add data attributes for filtering
            detailContainer.dataset.element = personaData[personaName].element;
            detailContainer.dataset.position = personaData[personaName].position;
            detailContainer.dataset.rarity = personaData[personaName].star;
            detailContainer.dataset.name = personaName;  // Add data-name attribute for search
            detailContainer.dataset.grade = personaData[personaName].grade;  // Add data-grade attribute for grade
            detailContainer.dataset.event = personaData[personaName].event;
            detailContainer.dataset.wild_emblem_rainbow = personaData[personaName].wild_emblem_rainbow;
            
            // Left card image section
            const cardSection = document.createElement('div');
            cardSection.className = 'persona-card-section';
            
            // Insert existing card creation code here
            const card = document.createElement('div');
            card.className = 'card';
            card.dataset.element = personaData[personaName].element;
            card.dataset.position = personaData[personaName].position;
            card.dataset.rarity = personaData[personaName].star;
            
            // Add card background with optimization
            const cardBg = document.createElement('img');
            cardBg.src = `{{ site.baseurl }}/assets/img/persona/persona-card-${personaData[personaName].element}.webp`;
            cardBg.alt = "card background";
            cardBg.className = 'card-background';
            cardBg.loading = 'lazy';
            cardBg.decoding = 'async';
            
            // Persona image with optimized lazy loading
            const img = document.createElement('img');
            img.src = `{{ site.baseurl }}/assets/img/persona/${personaName}.webp`;
            img.alt = personaName;
            img.className = 'persona-img';
            img.loading = 'lazy';
            img.decoding = 'async';  // ë¹„ë™ê¸° ë””ì½”ë”©ìœ¼ë¡œ ë Œë”ë§ ì„±ëŠ¥ í–¥ìƒ
            
            // Add rarity cover
            const coverStar = document.createElement('img');
            coverStar.src = `{{ site.baseurl }}/assets/img/persona/persona-cover-star${personaData[personaName].star}.webp`;
            coverStar.alt = "rarity cover";
            coverStar.className = 'cover-star';
            coverStar.loading = 'lazy';
            
            // Add remaining elements
            const positionContainer = document.createElement('div');
            positionContainer.className = 'position-container';
            
            const positionIcon = document.createElement('img');
            positionIcon.src = `{{ site.baseurl }}/assets/img/persona/ì§ì—…_${personaData[personaName].position}.png`;
            positionIcon.alt = personaData[personaName].position;
            positionIcon.className = 'position-icon';
            
            const elementIcon = document.createElement('img');
            elementIcon.src = `{{ site.baseurl }}/assets/img/persona/ì†ì„±_${personaData[personaName].element}.png`;
            elementIcon.alt = personaData[personaName].element;
            elementIcon.className = 'element-icon';

            
            positionContainer.appendChild(positionIcon);
            
            // Final assembly
            card.appendChild(cardBg);
            card.appendChild(img);
            card.appendChild(coverStar);
            card.appendChild(positionContainer);
            card.appendChild(elementIcon);
            
            cardSection.appendChild(card);
            
            // Right info section
            const infoSection = document.createElement('div');
            infoSection.className = 'persona-info-section';
            
            // ì–¸ì–´ë³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
            const persona = personaData[personaName];
            let displayName = personaName;
            let instinctName = persona.instinct.name;
            let instinctEffects = persona.instinct.effects;
            let uniqueSkillName = persona.uniqueSkill.name;
            let uniqueSkillEffect = persona.uniqueSkill.effect;
            let highlightEffect = persona.highlight.effect;
            let comment = persona.comment;
            
            // ì–¸ì–´ë³„ ë²ˆì—­ ì ìš©
            if (currentLang === 'en') {
                displayName = persona.name_en || personaName;
                instinctName = persona.instinct.name_en || persona.instinct.name;
                instinctEffects = persona.instinct.effects_en || persona.instinct.effects;
                uniqueSkillName = persona.uniqueSkill.name_en || persona.uniqueSkill.name;
                uniqueSkillEffect = persona.uniqueSkill.effect_en || persona.uniqueSkill.effect;
                highlightEffect = persona.highlight.effect_en || persona.highlight.effect;
                comment = persona.comment_en || persona.comment;
            } else if (currentLang === 'jp') {
                displayName = persona.name_jp || personaName;
                instinctName = persona.instinct.name_jp || persona.instinct.name;
                instinctEffects = persona.instinct.effects_jp || persona.instinct.effects;
                uniqueSkillName = persona.uniqueSkill.name_jp || persona.uniqueSkill.name;
                uniqueSkillEffect = persona.uniqueSkill.effect_jp || persona.uniqueSkill.effect;
                highlightEffect = persona.highlight.effect_jp || persona.highlight.effect;
                comment = persona.comment_jp || persona.comment;
            }
            
            // Name and grade
            const headerInfo = document.createElement('div');
            headerInfo.className = 'persona-header-info';
            if(personaData[personaName].wild_emblem_rainbow){
                headerInfo.innerHTML = `
                <h2>${displayName}</h2>
                <img class="persona-grade-img" src="{{ site.baseurl }}/assets/img/persona/persona-grade${personaData[personaName].grade}.webp" alt="Grade ${personaData[personaName].grade}">
                <img class="persona-wild-emblem-rainbow-img" src="{{ site.baseurl }}/assets/img/persona/wild-emblem-rainbow.png" style="width:20px; height:20px;" alt="How to get : Wild Emblem Rainbow">
            `;
            }else if(personaName !== "ì•¼ë…¸ì‹"){
                headerInfo.innerHTML = `
                <h2>${displayName}</h2>
                <img class="persona-grade-img" src="{{ site.baseurl }}/assets/img/persona/persona-grade${personaData[personaName].grade}.webp" alt="Grade ${personaData[personaName].grade}">
                <img class="persona-wild-emblem-rainbow-img" src="{{ site.baseurl }}/assets/img/persona/velvet.png" style="width:16px; height:16px; filter: drop-shadow(0px 1px rgb(255, 255, 255, 0.25)) drop-shadow(1px 0px rgb(255, 255, 255, 0.25)) drop-shadow(-1px 0px rgb(255, 255, 255, 0.25)) drop-shadow(0px -1px rgb(255, 255, 255, 0.25));" alt="How to get : velvet room">
            `;
            } else{
                headerInfo.innerHTML = `
                <h2>${displayName}</h2>
                <img class="persona-grade-img" src="{{ site.baseurl }}/assets/img/persona/persona-grade${personaData[personaName].grade}.webp" alt="Grade ${personaData[personaName].grade}">
            `;
            }

            
            // Instinct
            const instinctInfo = document.createElement('div');
            instinctInfo.className = 'persona-instinct-info';
            instinctInfo.dataset.priority = personaData[personaName].instinct.priority;
            
            // ë°°ì—´ì¸ ê²½ìš° ì¤„ë°”ê¿ˆìœ¼ë¡œ ì—°ê²°, ë¬¸ìì—´ì¸ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
            const effectsText = Array.isArray(instinctEffects) ? instinctEffects.join('\n') : instinctEffects;
            instinctInfo.innerHTML = `
                <h3>${instinctName}</h3>
                <p>${effectsText}</p>
            `;
            
            // Container for unique skill and highlight
            const skillContainer = document.createElement('div');
            skillContainer.className = 'skill-highlight-container';

            // Unique skill
            const uniqueSkillInfo = document.createElement('div');
            uniqueSkillInfo.className = 'persona-unique-skill-info';
            uniqueSkillInfo.dataset.priority = personaData[personaName].uniqueSkill.priority;
            uniqueSkillInfo.innerHTML = `
                <h3><img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_${personaData[personaName].uniqueSkill.icon}.png" alt="Skill Element" class="skill-type-icon"> ${uniqueSkillName}</h3>
                <p>${uniqueSkillEffect}</p>
            `;
            
            // Highlight - ì–¸ì–´ë³„ ë¼ë²¨ ì ìš©
            const highlightLabels = {
                'kr': 'HIGHLIGHT',
                'en': 'HIGHLIGHT', 
                'jp': 'ãƒã‚¤ãƒ©ã‚¤ãƒˆ'
            };
            const highlightLabel = highlightLabels[currentLang] || 'HIGHLIGHT';
            
            const highlightInfo = document.createElement('div');
            highlightInfo.className = 'persona-highlight-info';
            highlightInfo.dataset.priority = personaData[personaName].highlight.priority;
            highlightInfo.innerHTML = `
                <h3>${highlightLabel}</h3>
                <p>${highlightEffect}</p>
            `;

            // Add to container
            skillContainer.appendChild(uniqueSkillInfo);
            skillContainer.appendChild(highlightInfo);
            
            // Add elements to info section
            infoSection.appendChild(headerInfo);
            infoSection.appendChild(instinctInfo);
            infoSection.appendChild(skillContainer);  // Add container instead of individual elements

            // Recommended skill list - ì–¸ì–´ë³„ ë¼ë²¨ ì ìš©
            if (personaData[personaName].recommendSkill && personaData[personaName].recommendSkill.length > 0 && personaData[personaName].recommendSkill[0].name) {
                const recommendedSkillLabels = {
                    'kr': 'ì¶”ì²œ ìŠ¤í‚¬',
                    'en': 'Recommended Skills',
                    'jp': 'æ¨å¥¨ã‚¹ã‚­ãƒ«'
                };
                const recommendedSkillLabel = recommendedSkillLabels[currentLang] || 'ì¶”ì²œ ìŠ¤í‚¬';
                
                const recommendedSkills = document.createElement('div');
                recommendedSkills.className = 'persona-recommended-skills';
                recommendedSkills.innerHTML = `
                    <h3>${recommendedSkillLabel}</h3>
                    <ul>
                        ${personaData[personaName].recommendSkill.map(skill => {
                            const skillInfo = personaSkillList[skill.name];
                            if (!skillInfo) return ''; // Skip if skill info not found
                            
                            // ìŠ¤í‚¬ ì´ë¦„ê³¼ ì„¤ëª…ë„ ì–¸ì–´ë³„ë¡œ ë²ˆì—­ (í˜„ì¬ëŠ” í•œêµ­ì–´ë§Œ ìˆìœ¼ë¯€ë¡œ ê·¸ëŒ€ë¡œ ì‚¬ìš©)
                            let skillName = skill.name;
                            let skillDescription = skillInfo.description;
                            
                            // ì–¸ì–´ë³„ ìŠ¤í‚¬ ì´ë¦„ê³¼ ì„¤ëª… ì ìš©
                            if (currentLang === 'en') {
                                skillName = skillInfo.name_en || skill.name;
                                skillDescription = skillInfo.description_en || skillInfo.description;
                            } else if (currentLang === 'jp') {
                                skillName = skillInfo.name_jp || skill.name;
                                skillDescription = skillInfo.description_jp || skillInfo.description;
                            }
                            
                            return `
                                <li data-priority="${skill.priority}">
                                    <div class="skill-info">
                                        <img src="{{ site.baseurl }}/assets/img/persona/ì†ì„±_${skillInfo.icon}.png" alt="${skillInfo.icon}" class="skill-icon">
                                        <span class="skill-name">${skillName}</span>
                                        <span class="skill-description">${skillDescription}</span>
                                    </div>
                                </li>
                            `;
                        }).join('')}
                    </ul>
                `;
                infoSection.appendChild(recommendedSkills);
            }
            
            // Comment
            if (comment && comment.trim() !== '') {
                const commentDiv = document.createElement('div');
                commentDiv.className = 'persona-comment';
                commentDiv.innerHTML = `
                    <div class="comment-container">
                        <span class="comment-icon">ğŸ’¬</span>
                        <p>${comment}</p>
                    </div>
                `;
                infoSection.appendChild(commentDiv);
            }
            
            // Add sections to container
            detailContainer.appendChild(cardSection);
            detailContainer.appendChild(infoSection);
            
            cardsContainer.appendChild(detailContainer);

            // 15ê°œì˜ ì¹´ë“œë§ˆë‹¤ ê´‘ê³  ì‚½ì…
            
            if ((index + 1) % 15 === 1 && index < sortedPersonas.length - 1) 
            {
                const adContainer = document.createElement('div');
                adContainer.className = 'ad-container dynamic-ad';
                adContainer.style.overflow = 'visible';
                adContainer.style.width = '100%';
                adContainer.style.borderRadius = '10px';
                adContainer.style.marginTop = '-20px';

                // ê´‘ê³  ins íƒœê·¸ë§Œ ë™ì ìœ¼ë¡œ ì¶”ê°€
                const ins = document.createElement('ins');
                ins.className = 'adsbygoogle';
                ins.style.display = 'block';
                ins.setAttribute('data-ad-format', 'fluid');
                ins.setAttribute('data-ad-layout-key', '-er+5f+66-dn+4y');
                ins.setAttribute('data-ad-client', 'ca-pub-5862324369257695');
                ins.setAttribute('data-ad-slot', '6110222512');

                adContainer.appendChild(ins);
                cardsContainer.appendChild(adContainer);

                // ê´‘ê³  ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ (adsbygoogle ë°°ì—´ì´ ì¤€ë¹„ëœ í›„ì—)
                setTimeout(() => {
                    try {
                        (adsbygoogle = window.adsbygoogle || []).push({});
                    } catch (e) {
                        console.error("AdSense push failed:", e);
                    }
                }, 300);
            }

            // Initialize tooltips
            addTooltips();
        });

        // ----------------------------------------------------
        // Filter implementation

        const filterToggleBtn = document.querySelector('.filter-toggle-btn');
        const filterContent = document.querySelector('.filter-content');
        const filterResetBtn = document.querySelector('.filter-reset-btn');
        const checkboxes = document.querySelectorAll('.filter-options input[type="checkbox"]');
        filterContent.style.display = 'block';

        // Filter toggle
        filterToggleBtn.addEventListener('click', () => {
            filterContent.style.display = filterContent.style.display === 'none' ? 'block' : 'none';
        });
        
        // í•„í„° ë””ë°”ìš´ì‹±ì„ ìœ„í•œ íƒ€ì´ë¨¸
        let filterDebounceTimer;
        
        // Detect checkbox changes with debouncing
        checkboxes.forEach(checkbox => {
            checkbox.addEventListener('change', () => {
                // ë””ë°”ìš´ì‹± ì ìš©
                clearTimeout(filterDebounceTimer);
                filterDebounceTimer = setTimeout(() => {
                    // Check if any filters are selected
                    const hasChecked = Array.from(checkboxes).some(cb => cb.checked);
                    //filterResetBtn.style.display = hasChecked ? 'block' : 'none';
                    
                    // Apply filters
                    applyFilters();
                }, 50); // 50ms ë””ë°”ìš´ì‹±
            });
        });
        
        // Reset button
        
        filterResetBtn.addEventListener('click', () => {
            // ë°°ì¹˜ë¡œ ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë³€ê²½
            requestAnimationFrame(() => {
                checkboxes.forEach(cb => cb.checked = false);
                filterResetBtn.style.display = 'none';
                
                // ìºì‹œ ì´ˆê¸°í™”
                filterCache = {
                    elements: new Set(),
                    positions: new Set(), 
                    rarities: new Set(),
                    grades: new Set()
                };
                
                applyFilters();
            });
        });
        
        filterToggleBtn.style.display = 'none';
        filterResetBtn.style.display = 'none';

        // í•„í„° ìƒíƒœ ìºì‹±ì„ ìœ„í•œ ë³€ìˆ˜ë“¤
        let filterCache = {
            elements: new Set(),
            positions: new Set(), 
            rarities: new Set(),
            grades: new Set()
        };
        
        // ê´‘ê³  ê°€ì‹œì„± ê´€ë¦¬ í•¨ìˆ˜
        function manageAdVisibility() {
            const hasActiveFilters = Array.from(checkboxes).some(cb => cb.checked);
            const hasActiveSearch = searchInput && searchInput.value.trim() !== '';
            const isFilteringActive = hasActiveFilters || hasActiveSearch;
            
            const dynamicAds = document.querySelectorAll('.dynamic-ad');
            
            if (isFilteringActive) {
                // í•„í„°ë‚˜ ê²€ìƒ‰ì´ í™œì„±í™”ëœ ê²½ìš°: ë§ˆì§€ë§‰ ê´‘ê³ ë§Œ ë‚¨ê¸°ê³  ë‚˜ë¨¸ì§€ ìˆ¨ê¹€
                dynamicAds.forEach((ad, index) => {
                    if (index === dynamicAds.length - 1) {
                        // ë§ˆì§€ë§‰ ê´‘ê³ ëŠ” í‘œì‹œ
                        ad.style.display = 'block';
                    } else {
                        // ë‚˜ë¨¸ì§€ ê´‘ê³ ëŠ” ìˆ¨ê¹€
                        ad.style.display = 'none';
                    }
                });
            } else {
                // í•„í„°ë‚˜ ê²€ìƒ‰ì´ ë¹„í™œì„±í™”ëœ ê²½ìš°: ëª¨ë“  ê´‘ê³  í‘œì‹œ
                dynamicAds.forEach(ad => {
                    ad.style.display = 'block';
                });
            }
        }
        
        // ì„±ëŠ¥ ìµœì í™”ëœ í•„í„° ì ìš© í•¨ìˆ˜
        function applyFilters() {
            // í•„í„° ìƒíƒœë¥¼ Setìœ¼ë¡œ ìºì‹±í•˜ì—¬ ë¹ ë¥¸ ì¡°íšŒ
            filterCache.elements = new Set(Array.from(document.querySelectorAll('input[name="element"]:checked')).map(cb => cb.value));
            filterCache.positions = new Set(Array.from(document.querySelectorAll('input[name="position"]:checked')).map(cb => cb.value));
            filterCache.rarities = new Set(Array.from(document.querySelectorAll('input[name="rarity"]:checked')).map(cb => parseInt(cb.value)));
            filterCache.grades = new Set(Array.from(document.querySelectorAll('input[name="grade"]:checked')).map(cb => cb.value));
            
            const containers = document.querySelectorAll('.persona-detail-container');
            let visibleCount = 0;
            
            // requestAnimationFrameìœ¼ë¡œ DOM ì¡°ì‘ ë°°ì¹˜ ì²˜ë¦¬
            requestAnimationFrame(() => {
                containers.forEach(container => {
                    const element = container.dataset.element;
                    const position = container.dataset.position;
                    const rarity = parseInt(container.dataset.rarity);
                    const grade = container.dataset.grade;
                    const personaName = container.dataset.name;
                    
                    // Set.has()ë¡œ ë¹ ë¥¸ ì¡°íšŒ (O(1))
                    const elementMatch = filterCache.elements.size === 0 || filterCache.elements.has(element);
                    const positionMatch = filterCache.positions.size === 0 || filterCache.positions.has(position);
                    const rarityMatch = filterCache.rarities.size === 0 || filterCache.rarities.has(rarity);
                    const gradeMatch = filterCache.grades.size === 0 || 
                        filterCache.grades.has(grade) || 
                        (personaName === 'ì•¼ë…¸ì‹' && filterCache.grades.has('1'));
                    
                    const isVisible = elementMatch && positionMatch && rarityMatch && gradeMatch;
                    
                    // display ëŒ€ì‹  positionìœ¼ë¡œ ì„±ëŠ¥ ê°œì„  (ë ˆì´ì•„ì›ƒ ì¬ê³„ì‚° ë°©ì§€)
                    if (isVisible) {
                        container.style.position = 'relative';
                        container.style.visibility = 'visible';
                        container.style.height = 'auto';
                        visibleCount++;
                    } else {
                        container.style.position = 'absolute';
                        container.style.visibility = 'hidden';
                        container.style.height = '0';
                    }
                });
                
                // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                const countText = window.i18nFilteredCount || 'ì „ì²´';
                const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
                document.getElementById('filteredCount').textContent = `${countText} ${visibleCount}${countUnit}`;
                
                // ê´‘ê³  ê°€ì‹œì„± ê´€ë¦¬
                manageAdVisibility();
            });
        }

        // Search functionality implementation
        const searchInput = document.getElementById('personaSearch');
        const dropdown = document.getElementById('searchDropdown');
        const containers = document.querySelectorAll('.persona-detail-container');
        
        // ì–¸ì–´ë³„ í˜ë¥´ì†Œë‚˜ ì´ë¦„ ë§¤í•‘ ìƒì„±
        const personaNameMapping = {};
        Object.keys(personaData).forEach(koreanName => {
            const persona = personaData[koreanName];
            personaNameMapping[koreanName.toLowerCase()] = koreanName;
            
            // ì˜ì–´ ì´ë¦„ ì¶”ê°€
            if (persona.name_en) {
                personaNameMapping[persona.name_en.toLowerCase()] = koreanName;
            }
            
            // ì¼ë³¸ì–´ ì´ë¦„ ì¶”ê°€
            if (persona.name_jp) {
                personaNameMapping[persona.name_jp.toLowerCase()] = koreanName;
            }
        });

        // ë””ë°”ìš´ì‹±ì„ ìœ„í•œ íƒ€ì´ë¨¸
        let searchDebounceTimer;
        
        // ê²€ìƒ‰ í•¸ë“¤ëŸ¬ í•¨ìˆ˜ ë¶„ë¦¬
        function handleSearchInput(e) {
            const searchValue = e ? e.target.value.toLowerCase() : '';
            
            // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ (ì¦‰ì‹œ)
            updateDropdown(searchValue);
            
            // ê²€ìƒ‰ í•„í„°ë§ (ë””ë°”ìš´ì‹± ì ìš©)
            clearTimeout(searchDebounceTimer);
            searchDebounceTimer = setTimeout(() => {
                filterBySearch(searchValue);
            }, 100); // 100ms ë””ë°”ìš´ì‹±
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
        searchInput.addEventListener('input', handleSearchInput);
        
        // ë“œë¡­ë‹¤ìš´ ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ë¶„ë¦¬
        function updateDropdown(searchValue) {
            dropdown.innerHTML = '';
            
            if (searchValue.length > 0) {
                const matches = Object.keys(personaNameMapping).filter(name => 
                    name.includes(searchValue)
                ).slice(0, 10); // ì„±ëŠ¥ì„ ìœ„í•´ ìµœëŒ€ 10ê°œë¡œ ì œí•œ

                if (matches.length > 0) {
                    dropdown.style.display = 'block';
                    
                    // DocumentFragmentë¡œ ë°°ì¹˜ DOM ì¶”ê°€
                    const fragment = document.createDocumentFragment();
                    
                    matches.forEach(matchedName => {
                        const koreanName = personaNameMapping[matchedName];
                        const persona = personaData[koreanName];
                        
                        // í˜„ì¬ ì–¸ì–´ì— ë§ëŠ” í‘œì‹œ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°
                        let displayName = koreanName;
                        if (currentLang === 'en' && persona.name_en) {
                            displayName = persona.name_en;
                        } else if (currentLang === 'jp' && persona.name_jp) {
                            displayName = persona.name_jp;
                        }
                        
                        const div = document.createElement('div');
                        div.className = 'dropdown-item';
                        div.textContent = displayName;
                        div.addEventListener('click', () => {
                            searchInput.value = displayName;
                            dropdown.style.display = 'none';
                            filterBySearch(matchedName.toLowerCase());
                        });
                        fragment.appendChild(div);
                    });
                    
                    dropdown.appendChild(fragment);
                } else {
                    dropdown.style.display = 'none';
                }
            } else {
                dropdown.style.display = 'none';
            }
        }

        // ê²€ìƒ‰ ê²°ê³¼ ìºì‹±
        let searchCache = new Map();
        
        // ì„±ëŠ¥ ìµœì í™”ëœ ê²€ìƒ‰ í•„í„°ë§ í•¨ìˆ˜
        function filterBySearch(searchValue) {
            // ìºì‹œì—ì„œ ê²°ê³¼ í™•ì¸
            if (searchCache.has(searchValue)) {
                applySearchResults(searchCache.get(searchValue));
                return;
            }
            
            const containers = document.querySelectorAll('.persona-detail-container');
            let visibleCount = 0;
            const results = [];
            
            // requestAnimationFrameìœ¼ë¡œ ë°°ì¹˜ ì²˜ë¦¬
            requestAnimationFrame(() => {
                containers.forEach(container => {
                    const koreanName = container.dataset.name;
                    const persona = personaData[koreanName];
                    
                    // ëª¨ë“  ì–¸ì–´ ì´ë¦„ìœ¼ë¡œ ê²€ìƒ‰ ê°€ëŠ¥í•˜ë„ë¡
                    const searchableNames = [
                        koreanName.toLowerCase(),
                        persona.name_en ? persona.name_en.toLowerCase() : '',
                        persona.name_jp ? persona.name_jp.toLowerCase() : ''
                    ].filter(name => name); // ë¹ˆ ë¬¸ìì—´ ì œê±°
                    
                    const isVisible = searchValue === '' || searchableNames.some(name => name.includes(searchValue));
                    
                    // display ëŒ€ì‹  positionìœ¼ë¡œ ì„±ëŠ¥ ê°œì„ 
                    if (isVisible) {
                        container.style.position = 'relative';
                        container.style.visibility = 'visible';
                        container.style.height = 'auto';
                        visibleCount++;
                    } else {
                        container.style.position = 'absolute';
                        container.style.visibility = 'hidden';
                        container.style.height = '0';
                    }
                    
                    results.push(isVisible);
                });
                
                // ê²°ê³¼ ìºì‹± (ìµœëŒ€ 50ê°œê¹Œì§€ë§Œ)
                if (searchCache.size < 50) {
                    searchCache.set(searchValue, results);
                }
                
                // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                const countText = window.i18nFilteredCount || 'ì „ì²´';
                const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
                document.getElementById('filteredCount').textContent = `${countText} ${visibleCount}${countUnit}`;
                
                // ê´‘ê³  ê°€ì‹œì„± ê´€ë¦¬
                manageAdVisibility();
            });
        }
        
        // ìºì‹œëœ ê²€ìƒ‰ ê²°ê³¼ ì ìš© í•¨ìˆ˜
        function applySearchResults(results) {
            const containers = document.querySelectorAll('.persona-detail-container');
            let visibleCount = 0;
            
            requestAnimationFrame(() => {
                containers.forEach((container, index) => {
                    const isVisible = results[index];
                    
                    if (isVisible) {
                        container.style.position = 'relative';
                        container.style.visibility = 'visible';
                        container.style.height = 'auto';
                        visibleCount++;
                    } else {
                        container.style.position = 'absolute';
                        container.style.visibility = 'hidden';
                        container.style.height = '0';
                    }
                });
                
                // ì¹´ìš´íŠ¸ ì—…ë°ì´íŠ¸
                const countText = window.i18nFilteredCount || 'ì „ì²´';
                const countUnit = window.i18nCountUnit !== undefined ? window.i18nCountUnit : (currentLang === 'kr' ? 'ê°œ' : '');
                document.getElementById('filteredCount').textContent = `${countText} ${visibleCount}${countUnit}`;
                
                // ê²€ìƒ‰ í›„ ê´‘ê³  ê°€ì‹œì„± ê´€ë¦¬
                manageAdVisibility();
            });
        }

        // Close dropdown when clicking outside search
        document.addEventListener('click', (e) => {
            if (!searchInput.contains(e.target) && !dropdown.contains(e.target)) {
                dropdown.style.display = 'none';
            }
        });

        // When keyboard appears
        searchInput.addEventListener('focus', () => {
            document.body.classList.add('keyboard-open');
        });

        // When keyboard disappears
        searchInput.addEventListener('blur', () => {
            document.body.classList.remove('keyboard-open');
        });

        // Prevent viewport size changes on iOS
        if (/iPad|iPhone|iPod/.test(navigator.userAgent)) {
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                viewport.content = 'width=device-width, initial-scale=1, maximum-scale=1';
            }
        }
    } // initializePageContent í•¨ìˆ˜ ì¢…ë£Œ
    
    // ì–¸ì–´ë³„ ì„¤ëª… ë°•ìŠ¤ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ í•¨ìˆ˜
    function updateExplainBoxTexts(currentLang) {
        const explainTexts = {
            kr: {
                instinct_title: "ë³¸ëŠ¥ Â· ê³ ìœ  ìŠ¤í‚¬ Â· HIGHLIGHT",
                skills_title: "ì¶”ì²œ ìŠ¤í‚¬",
                priority_label: "ì¤‘ìš”ë„ :",
                priority_label2: "ìš°ì„ ìˆœìœ„ :",
                priority_high: "ìƒ",
                priority_medium: "ì¤‘", 
                priority_low: "í•˜",
                priority_normal: "ì¼ë°˜",
                priority_very_low: "ë§¤ìš° ë‚®ìŒ",
                priority_highest: "ë†’ìŒ"
            },
            en: {
                instinct_title: "Core Passive Â· Unique Skill Â· HIGHLIGHT",
                skills_title: "Recommended Skills", 
                priority_label: "Importance :",
                priority_label2: "Priority :",
                priority_high: "High",
                priority_medium: "Med",
                priority_low: "Low", 
                priority_normal: "Normal",
                priority_very_low: "Very Low",
                priority_highest: "High"
            },
            jp: {
                instinct_title: "æœ¬èƒ½ Â· å›ºæœ‰ã‚¹ã‚­ãƒ« Â· ãƒã‚¤ãƒ©ã‚¤ãƒˆ",
                skills_title: "æ¨å¥¨ã‚¹ã‚­ãƒ«",
                priority_label: "é‡è¦åº¦ :",
                priority_label2: "å„ªå…ˆé †ä½ :",
                priority_high: "é«˜",
                priority_medium: "ä¸­",
                priority_low: "ä½",
                priority_normal: "ä¸€èˆ¬", 
                priority_very_low: "éå¸¸ã«ä½ã„",
                priority_highest: "é«˜ã„"
            }
        };
        
        const currentExplainTexts = explainTexts[currentLang] || explainTexts['kr'];
        
        // ì„¤ëª… ë°•ìŠ¤ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const explainSections = document.querySelectorAll('.explain-section h4');
        if (explainSections[0]) explainSections[0].textContent = currentExplainTexts.instinct_title;
        if (explainSections[1]) explainSections[1].textContent = currentExplainTexts.skills_title;
        
        const priorityLabels = document.querySelectorAll('.priority-label');
        if (priorityLabels[0]) priorityLabels[0].textContent = currentExplainTexts.priority_label;
        if (priorityLabels[1]) priorityLabels[1].textContent = currentExplainTexts.priority_label2;
        
        // ìš°ì„ ìˆœìœ„ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        const priorityTexts = document.querySelectorAll('[data-priority-text]');
        priorityTexts.forEach(element => {
            const type = element.dataset.priorityText;
            switch(type) {
                case 'high':
                    element.textContent = currentExplainTexts.priority_highest;
                    break;
                case 'normal':
                    element.textContent = currentExplainTexts.priority_normal;
                    break;
                case 'low':
                    element.textContent = currentExplainTexts.priority_low;
                    break;
                case 'very-low':
                    element.textContent = currentExplainTexts.priority_very_low;
                    break;
            }
        });
        
        // ê¸°ì¡´ ìš°ì„ ìˆœìœ„ ì•„ì´í…œë“¤ (ì„¤ëª… ë°•ìŠ¤ ì²« ë²ˆì§¸ ì„¹ì…˜)
        const priorityItems = document.querySelectorAll('.priority-item span');
        if (priorityItems[0]) priorityItems[0].textContent = currentExplainTexts.priority_high;
        if (priorityItems[1]) priorityItems[1].textContent = currentExplainTexts.priority_medium;
        if (priorityItems[2]) priorityItems[2].textContent = currentExplainTexts.priority_low;
        if (priorityItems[3]) priorityItems[3].textContent = currentExplainTexts.priority_highest;
        if (priorityItems[4]) priorityItems[4].textContent = currentExplainTexts.priority_normal;
        if (priorityItems[5]) priorityItems[5].textContent = currentExplainTexts.priority_low;
        if (priorityItems[6]) priorityItems[6].textContent = currentExplainTexts.priority_very_low;
    }

    // ê´‘ê³  í° ë°•ìŠ¤ ìˆ¨ê¹€
    setTimeout(() => {
        document.querySelectorAll(".adsbygoogle").forEach(el => {
            const status = el.getAttribute("data-ad-status");
            const adslot = el.getAttribute("data-ad-slot");
            console.log("google status", status);
            console.log("google adslot", adslot);
            if (status === "unfilled" || el.querySelector("iframe") === null) {
                el.style.display = "none";
            }
        });
    }, 2000);  // ê´‘ê³  ë¡œë”© ê¸°ë‹¤ë ¸ë‹¤ê°€ 2ì´ˆ í›„ ê²€ì‚¬
</script>



<style>
.explain-container {
    margin: 20px 0 0 0;
    padding: 0 20px;
}

.explain-box {
    width: 100%;
    box-sizing: border-box;
    display: flex;
    flex-direction: row;
    gap: 48px;
    flex-wrap: wrap;
    background: rgba(0, 0, 0, 0.3);
    border-radius: 12px;
    padding: 20px;
    color: #fff;
}

@media (max-width: 1200px) {
    .explain-container {
        padding: 0;
    }
    .explain-box {
        gap: 24px;
    }
}

.explain-section h4 {
    margin: 0 0 16px 0;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.8);
}

.priority-label {
    font-size: 14px;
    color: rgba(255, 255, 255, 0.8);
}

.priority-examples {
    display: flex;
    gap: 20px;
    font-size: 14px;
}

.priority-item {
    display: flex;
    align-items: center;
    gap: 8px;
}

.priority-item span {
    color: rgba(255, 255, 255, 0.8);
}

.priority-box {
    width: 20px;
    height: 20px;
    border-radius: 8px;
    background-color: rgba(255, 255, 255, 0.05);
}

</style>