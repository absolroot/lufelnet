<script>
(function () {
    var params = new URLSearchParams(window.location.search || '');
    var path = String(window.location.pathname || '/');
    var lowerPath = path.toLowerCase();

    var pathLangMatch = lowerPath.match(/^\/(kr|en|jp)(\/|$)/);
    var pathLang = pathLangMatch ? pathLangMatch[1] : '';
    var queryLang = String(params.get('lang') || '').toLowerCase();
    var effectiveLang = pathLang || (['kr', 'en', 'jp'].indexOf(queryLang) !== -1 ? queryLang : '');

    var isLegacyRoot = /^\/about\/?$/.test(lowerPath);
    var isCanonicalPath = /^\/(kr|en|jp)\/about\/?$/.test(lowerPath);

    if (isLegacyRoot && effectiveLang) {
        window.__SEO_PATH_LANG__ = effectiveLang;
        params.delete('lang');
        params.delete('v');
        var remainingLegacy = params.toString();
        history.replaceState(null, '', '/' + effectiveLang + '/about/' + (remainingLegacy ? '?' + remainingLegacy : ''));
        return;
    }

    if (isCanonicalPath) {
        window.__SEO_PATH_LANG__ = pathLang;
        var before = params.toString();
        params.delete('lang');
        params.delete('v');
        var remainingCanonical = params.toString();
        if (before !== remainingCanonical) {
            history.replaceState(null, '', path + (remainingCanonical ? '?' + remainingCanonical : ''));
        }
        return;
    }

    if (isLegacyRoot && params.has('v')) {
        params.delete('v');
        var remainingRoot = params.toString();
        history.replaceState(null, '', '/about/' + (remainingRoot ? '?' + remainingRoot : ''));
    }
})();
</script>
{% if page.alternate_urls %}
{% for alt in page.alternate_urls %}
<link rel="alternate" hreflang="{{ alt[0] }}" href="{{ site.url }}{{ alt[1] }}" />
{% endfor %}
<link rel="alternate" hreflang="x-default" href="{{ site.url }}{{ page.alternate_urls['ko'] | default: page.alternate_urls.first[1] }}" />
{% endif %}

<div class="main-wrapper">
    <!-- 언어 안내 메시지 -->
    <div id="language-notice" class="language-notice" style="display: none;">
        <p id="language-notice-text"></p>
    </div>

    <div class="header-container">
    </div>

    <div class="about-content">
        <div class="about-section">
            <h2 id="site-title">루페르넷 lufel.net</h2>
            <p id="site-description" class="korean-content">
                루페르넷은 '페르소나5 더 팬텀 X' 플레이어를 위해 개인이 만든 비공식 정보 사이트입니다.
                <br>
                보다 많은 사람들이 P5X를 즐겼으면 좋겠다는 마음가짐에서 시작했습니다.
            </p>
            <p id="site-description-en" class="english-content" style="display: none;">
                Lufel.net is an unofficial information site created by an individual for Persona 5 The Phantom X
                players.
                <br>
                It started with the hope that more people would enjoy P5X.
                <br><br>
                <strong>The strategy information provided on this site is contributed by top-ranking players from the
                    Korean server.</strong>
            </p>
            <p id="site-description-jp" class="japanese-content" style="display: none;">
                Lufel.netは「ペルソナ5 ザ ファントム X」プレイヤーのために個人が作成した非公式情報サイトです。
                <br>
                より多くの人がP5Xを楽しんでくれればという気持ちから始まりました。
                <br><br>
                <strong>このサイトで提供される攻略情報は、韓国サーバーの上位ランカーによって提供されています。</strong>
            </p>
        </div>

        <div class="about-section">
            <h2 id="contact-title">문의 및 피드백</h2>
            <p id="contact-description" class="korean-content">
                버그, 잘못된 데이터를 발견하거나 피드백이 있으실 경우
                <a href="https://discord.gg/8S8pnv2MsH" target="_blank" class="discord-link"><span
                        class="discord-icon"></span>디스코드</a> 또는
                <a href="mailto:superphil722@gmail.com" class="email-link">superphil722@gmail.com</a>로 문의주세요.
            </p>
            <p id="contact-description-en" class="english-content" style="display: none;">
                If you find bugs, incorrect data, or have feedback, please contact us via
                <a href="https://discord.gg/8S8pnv2MsH" target="_blank" class="discord-link"><span
                        class="discord-icon"></span>Discord</a> or
                <a href="mailto:superphil722@gmail.com" class="email-link">superphil722@gmail.com</a>.
            </p>
            <p id="contact-description-jp" class="japanese-content" style="display: none;">
                バグや間違ったデータを発見したり、フィードバックがある場合は
                <a href="https://discord.gg/8S8pnv2MsH" target="_blank" class="discord-link"><span
                        class="discord-icon"></span>Discord</a> または
                <a href="mailto:superphil722@gmail.com" class="email-link">superphil722@gmail.com</a>までお問い合わせください。
            </p>
            <a href="https://x.com/Absolroot" target="_blank" class="twitter-link"
                style="text-decoration: none; font-weight: bold;"><span class="twitter-icon"></span>Twitter
                @absolroot</a>

        </div>

        <!--
        <div class="about-section" id="exchange-code-section">
            <button id="exchangeCodeButton" class="donate-button">KR 교환코드 (v4.4.1)</button>
        </div>
        -->

        <div class="about-section">
            <button id="donateButton" class="donate-button" data-kr="서포트 | Donate" data-en="Support | Donate"
                data-jp="サポート | 寄付">서포트 | Donate</button>
            <p id="donate-description" class="korean-content">
                루페르넷은 오로지 여러분의 지원을 통해서만 운영됩니다.
            </p>
            <p id="donate-description-en" class="english-content" style="display: none;">LufelNet is made possible
                entirely by your support.</p>
            <p id="donate-description-jp" class="japanese-content" style="display: none;">ルフェルネットは、皆様のご支援によってのみ運営されています。
            </p>
        </div>

        <!-- Inline donate (EN/JP only) -->
        <div class="about-section" id="donate-inline" style="display: none;">
            <div id="donation-inline-text"></div>

            <!-- JP: Fanbox Button -->
            <div id="fanbox-inline-container" style="display: none; margin-bottom: 12px;">
                <a href="https://absolroot.fanbox.cc/plans" target="_blank" class="fanbox-button" style="
                    display: inline-flex;
                    align-items: center;
                    gap: 8px;
                    background-color: #F5F5F5;
                    color: #333;
                    text-decoration: none;
                    font-weight: bold;
                    padding: 10px 20px;
                    border-radius: 8px;
                    border: 1px solid #ddd;
                    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                    transition: all 0.2s;
                 ">
                    <img src="https://img.icons8.com/color/48/pixiv.png" alt="pixiv" style="width: 24px; height: 24px;">
                    <span>pixivFANBOXで支援する</span>
                </a>
            </div>

            <div class="kofi-inline" id="kofiInline"></div>
        </div>

        <div class="about-section">
            <h2 id="thanks-title">Thanks To</h2>
            <p id="thanks-description" class="korean-content">
                <button class="show-supporters-btn" onclick="showSupporters()">감사한 분들</button>
            </p>
            <p id="thanks-description-en" class="english-content" style="display: none;">
                <button class="show-supporters-btn" onclick="showSupporters()">Supporters</button>
            </p>
            <p id="thanks-description-jp" class="japanese-content" style="display: none;">
                <button class="show-supporters-btn" onclick="showSupporters()">サポーターリスト</button>
            </p>
        </div>

        <!-- 후원자 목록 모달 -->
        <div id="supporters-modal" class="modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h3 id="supporters-title">서포터 목록</h3>
                <div class="supporters-list">
                    <div class="supporter-tier">
                        <h4>Special Thanks</h4>
                        <ul>
                            <li style="color:#ffd34e; font-weight:700;">Data/Pull Tracker : Iant</li>
                            <li>Translation : RedHarv (EN)</li>
                            <li>Translation : Em (EN)</li>
                            <li>Translation : kai (JP)</li>
                        </ul>
                    </div>
                    <div class="supporter-tier">
                        <h4>Supporters</h4>
                        <ul>
                            <li style="color:#ffd34e; font-weight:700;">Alyda</li> <!--100$ 26/01/21-->
                            <li style="color:#fff8e1">시아</li> <!--99$ 25/07/10-->
                            <li style="color:#ad7326">SpoonceDaSpoon</li> <!--54$ 26/01/20-->
                            <li>Arthur</li> <!--30$ 25/08/10-->
                            <li>EMajorinc</li> <!--30$ 26/01/21-->
                            <li>안*현</li> <!--30000 25/09/10-->
                            <li>이*현</li> <!--30000 26/01/02-->
                            <li>Sages</li> <!--6$ 25/09/06 20$ 26/01/31--> 
                            <li>Skizor Kurogane</li><!--21$ 25/12/20 3$ 26/02/05-->
                            <li>Zeloid</li><!--21$ 26/01/31 -->
                            <li>ue</li> <!--15$ 25/09/09-->
                            <li>rudytudysubs</li><!--15$ 26/01/18-->
                            <li>ZexVolts</li><!--15$ 26/02/01-->
                            <li>Trishelle</li> <!--12$ 26/01/20-->
                            <li>skippy</li> <!--12$ 26/01/21-->
                            <li>Chron</li> <!--12$ 26/02/01-->
                            <li>Xylex(SEA)</li> <!--6$ 25/11--> <!--6$ 26/01/29-->
                            <li>kai</li> <!--9$ 25/08/22-->
                            <li>김*환</li> <!--9$ 25/07/18-->
                            <li>임*훈</li><!--10000 25/07/06-->
                            <li>김*현</li> <!--10000 25/05/18-->
                            <li>카미유</li> <!--10000 25/07/18-->
                            <li>서*일</li> <!--10000 25/09/19-->
                            <li>ochette</li> <!--6$ 25/06/18-->
                            <li>Denys</li> <!--6$ 25/12/27-->
                            <li>Matsu</li> <!--6$ 25/12/31-->
                            <li>Viiun</li> <!--6$ 26/01/02-->
                            <li>ShibaEnjoyer</li> <!--6$ 26/01/12-->
                            <li>Seagull</li> <!--6$ 26/01/20-->
                            <li>Odderpop</li> <!--6$ 26/01/21-->
                            <li>lpmafiota</li> <!--6$ 26/01/31-->
                            <li>Ieat coffe</li> <!--6$ 26/01/31-->
                            <li>Dinjoralo</li> <!--5$ 26/01/31-->
                            <li>Nova</li> <!--3$ 26/01/07-->
                            <li>Nerecky</li> <!--3$ 25/09/10-->
                            <li>Main</li> <!--3$ 25/10/18-->
                            <li>Shira</li> <!--3$ 26/01/20-->
                            <li>Figaf Hguk</li> <!--3$ 26/01/21-->
                            <li>Vexx</li> <!--3$ 26/01/29-->
                            <li>W.AlexRonke</li> <!--3$ 26/01/31-->
                            <li>Dddock</li><!--3$ 26/02/03-->
                            <li>Ravengod</li><!--3$ 26/02/03-->
                            <li>Night Phoenix</li><!--3$ 26/02/01-->
                            <li>Ian</li><!--3000 25/06/20-->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <style>
            .show-supporters-btn {
                background-color: var(--card-background);
                color: rgba(255, 255, 255, 0.9);
                border: 1px solid rgba(255, 255, 255, 0.2);
                padding: 5px 10px;
                border-radius: 4px;
                cursor: pointer;
                font-size: 14px;
                transition: background-color 0.2s;
            }

            .show-supporters-btn:hover {
                background-color: #4a3a3a;
            }

            .modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background-color: rgba(0, 0, 0, 0.7);
                z-index: 1000;
            }

            .modal-content {
                position: relative;
                background-color: #2a2a2a;
                margin: 15% auto;
                padding: 20px;
                width: 80%;
                max-width: 600px;
                border-radius: 8px;
                color: #fff;
            }

            .close-modal {
                position: absolute;
                right: 20px;
                top: 10px;
                font-size: 28px;
                font-weight: bold;
                color: #aaa;
                cursor: pointer;
            }

            .close-modal:hover {
                color: #fff;
            }

            .supporters-list {
                margin-top: 20px;
            }

            .supporter-tier {
                margin-bottom: 20px;
            }

            .supporter-tier h4 {
                color: rgba(255, 255, 255, 0.9);
                margin-bottom: 10px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                padding-bottom: 5px;
            }

            .supporter-tier ul {
                list-style: none;
                padding: 0;
                margin: 0;
                display: flex;
                flex-wrap: wrap;
                gap: 10px;
            }

            .supporter-tier li {
                background: rgba(255, 255, 255, 0.1);
                padding: 5px 10px;
                border-radius: 4px;
                font-size: 14px;
            }

            .discord-link {
                display: inline-flex;
                align-items: center;
                gap: 5px;
                text-decoration: none;
                color: #6f84f8 !important;
            }

            .discord-icon {
                width: 20px;
                height: 20px;
                display: inline-block;
                background-image: url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 127.14 96.36"><path fill="%23fff" d="M107.7,8.07A105.15,105.15,0,0,0,81.47,0a72.06,72.06,0,0,0-3.36,6.83A97.68,97.68,0,0,0,49,6.83,72.37,72.37,0,0,0,45.64,0,105.89,105.89,0,0,0,19.39,8.09C2.79,32.65-1.71,56.6.54,80.21h0A105.73,105.73,0,0,0,32.71,96.36,77.7,77.7,0,0,0,39.6,85.25a68.42,68.42,0,0,1-10.85-5.18c.91-.66,1.8-1.34,2.66-2a75.57,75.57,0,0,0,64.32,0c.87.71,1.76,1.39,2.66,2a68.68,68.68,0,0,1-10.87,5.19,77,77,0,0,0,6.89,11.1A105.25,105.25,0,0,0,126.6,80.22h0C129.24,52.84,122.09,29.11,107.7,8.07ZM42.45,65.69C36.18,65.69,31,60,31,53s5-12.74,11.43-12.74S54,46,53.89,53,48.84,65.69,42.45,65.69Zm42.24,0C78.41,65.69,73.25,60,73.25,53s5-12.74,11.44-12.74S96.23,46,96.12,53,91.08,65.69,84.69,65.69Z"/></svg>');
                background-size: contain;
                background-repeat: no-repeat;
                vertical-align: middle;
            }

            @media (max-width: 1200px) {
                .modal-content {
                    margin: 20% auto;
                    width: 90%;
                    padding: 15px;
                }
            }
        </style>

        <script>
            function showSupporters() {
                const modal = document.getElementById('supporters-modal');
                modal.style.display = 'block';

                // i18n 키로 모달 타이틀 갱신
                const title = document.getElementById('supporters-title');
                if (title) {
                    title.textContent = getI18nText('supportersModalTitle', title.textContent || '');
                }
            }

            // 모달 닫기 버튼 이벤트
            document.querySelector('.close-modal').addEventListener('click', function () {
                document.getElementById('supporters-modal').style.display = 'none';
            });

            // 모달 외부 클릭 시 닫기
            window.addEventListener('click', function (event) {
                const modal = document.getElementById('supporters-modal');
                if (event.target === modal) {
                    modal.style.display = 'none';
                }
            });
        </script>

        <div class="about-section recent-update-content drag-me">
            <h2 id="recent-updates-title">최신 업데이트</h2>
            <div id="recent-update-list"></div>
            <button id="show-more-updates-btn" class="show-more-updates-btn" style="display: none;"
                data-text-more="더보기">더보기</button>
        </div>
    </div>
</div>

<!-- 후원 모달 -->
<div id="donateModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <p id="donation-message-kr" class="donation-message korean-content">
            감사합니다. P5X를 분석하길 좋아하는 유저로서 지속적으로 업데이트하고 있습니다.
            <br>
            응원해주신다면 사이트를 보다 발전시키는 좋은 원동력으로 삼겠습니다.
            <br>
            진심으로 감사드립니다.
        </p>
        <p id="donation-message-en" class="donation-message english-content" style="display: none;">
            As a user who truly loves P5X, I am continuously managing lufel.net.<br>
            Your donation will be a great driving force for improving the site.<br>
            LufelNet is made possible entirely by your support. Thank you sincerely.
        </p>
        <p id="donation-message-jp" class="donation-message japanese-content" style="display: none;">
            P5Xを愛するユーザーとして、lufel.netを継続的に管理しています。<br>
            あなたの寄付はサイトを改善する大きな原動力になります。<br>
            ルフェルネットは、皆様のご支援によってのみ運営されています。心から感謝いたします。
        </p>

        <div class="donation-methods">
            <div class="kofi-container">
                <script type='text/javascript' src='https://storage.ko-fi.com/cdn/widget/Widget_2.js'></script>
                <script
                    type='text/javascript'>kofiwidget2.init('Support me on Ko-fi', '#72a4f2', 'S6S11F0PUN'); kofiwidget2.draw();</script>
            </div>

            <!--
                    <div class="bmc-container">
                        <script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="absol" data-color="#FFDD00" data-emoji="☕" data-font="Cookie" data-text="Buy me a coffee" data-outline-color="#000000" data-font-color="#000000" data-coffee-color="#ffffff"></script>
                    </div>-->

            <div class="kakao-pay-container" id="kakao-pay-container">
                <button id="kakaoPayButton" class="kakao-pay-button">Kakaopay</button>
            </div>
        </div>
    </div>
</div>

<!-- 카카오페이 QR 모달 -->
<div id="kakaoPayModal" class="modal">
    <div class="modal-content kakao-modal">
        <span class="close-button">&times;</span>
        <div class="kakao-qr-container">
            <img src="{{ site.baseurl }}/assets/img/logo/kakaopay.png" alt="카카오페이 QR" class="kakao-qr">
        </div>
    </div>
</div>

<!-- 교환코드 모달 -->
<div id="exchangeCodeModal" class="modal">
    <div class="modal-content">
        <span class="close-button">&times;</span>
        <h3>KR 교환코드 (v4.4.1)</h3>
        <p class="exchange-notice">
            한국 서버 크리에이터 프로그램을 통해 제공되는 교환코드입니다. 비정기적으로 업데이트 될 수 있습니다.
        </p>
        <div class="exchange-codes" id="exchangeCodesContainer">
            <!-- 코드들이 JavaScript로 동적 생성됩니다 -->
        </div>
    </div>
</div>

<script defer src="{{ site.baseurl }}/i18n/service/i18n-adapter.js?v={{ site.time | date: '%s' }}"></script>
<script>
    function detectAboutLang() {
        const pathMatch = window.location.pathname.match(/^\/(kr|en|jp)(\/|$)/i);
        if (pathMatch) {
            return pathMatch[1].toLowerCase();
        }

        const params = new URLSearchParams(window.location.search);
        const queryLang = String(params.get('lang') || '').toLowerCase();
        if (['kr', 'en', 'jp'].indexOf(queryLang) !== -1) {
            return queryLang;
        }

        if (typeof getCurrentLang === 'function') {
            const helperLang = String(getCurrentLang() || '').toLowerCase();
            if (['kr', 'en', 'jp'].indexOf(helperLang) !== -1) {
                return helperLang;
            }
        }

        if (typeof LanguageRouter !== 'undefined' && typeof LanguageRouter.getCurrentLanguage === 'function') {
            const routerLang = String(LanguageRouter.getCurrentLanguage() || '').toLowerCase();
            if (['kr', 'en', 'jp'].indexOf(routerLang) !== -1) {
                return routerLang;
            }
        }

        return 'kr';
    }

    function getI18nText(key, fallback = '') {
        if (typeof window.t === 'function') {
            return window.t(key, fallback);
        }
        if (window.I18nService && typeof window.I18nService.t === 'function') {
            return window.I18nService.t(key, fallback);
        }
        return fallback || key;
    }

    // 다국어 지원 함수
    async function updateLanguageContent() {
        const currentLang = detectAboutLang();

        // 제목 업데이트
        const siteTitle = document.getElementById('site-title');
        const contactTitle = document.getElementById('contact-title');
        const thanksTitle = document.getElementById('thanks-title');
        const donateButton = document.getElementById('donateButton');
        const recentUpdatesTitle = document.getElementById('recent-updates-title');
        const showMoreUpdatesBtn = document.getElementById('show-more-updates-btn');
        const supportersButtons = document.querySelectorAll('.show-supporters-btn');
        const supportersTitle = document.getElementById('supporters-title');

        if (siteTitle) siteTitle.textContent = getI18nText('siteTitle', siteTitle.textContent || '');
        if (contactTitle) contactTitle.textContent = getI18nText('contactTitle', contactTitle.textContent || '');
        if (thanksTitle) thanksTitle.textContent = getI18nText('thanksTitle', thanksTitle.textContent || '');
        if (donateButton) donateButton.textContent = getI18nText('donateButton', donateButton.textContent || '');
        if (recentUpdatesTitle) recentUpdatesTitle.textContent = getI18nText('recentUpdatesTitle', recentUpdatesTitle.textContent || '');
        if (showMoreUpdatesBtn) showMoreUpdatesBtn.textContent = getI18nText('showMoreButton', showMoreUpdatesBtn.textContent || '');
        if (supportersButtons.length > 0) {
            const supportersText = getI18nText('supportersButton', '');
            if (supportersText) {
                supportersButtons.forEach(btn => {
                    btn.textContent = supportersText;
                });
            }
        }
        if (supportersTitle) {
            supportersTitle.textContent = getI18nText('supportersModalTitle', supportersTitle.textContent || '');
        }

        const notice = document.getElementById('language-notice');
        if (notice) {
            notice.style.display = 'none';
        }

        // 언어별 콘텐츠 표시/숨김
        const koreanContent = document.querySelectorAll('.korean-content');
        const englishContent = document.querySelectorAll('.english-content');
        const japaneseContent = document.querySelectorAll('.japanese-content');

        // 모든 언어 콘텐츠 숨김
        koreanContent.forEach(el => el.style.display = 'none');
        englishContent.forEach(el => el.style.display = 'none');
        japaneseContent.forEach(el => el.style.display = 'none');

        // 현재 언어 콘텐츠만 표시
        if (currentLang === 'kr') {
            koreanContent.forEach(el => el.style.display = 'block');
        } else if (currentLang === 'en') {
            englishContent.forEach(el => el.style.display = 'block');
        } else if (currentLang === 'jp') {
            japaneseContent.forEach(el => el.style.display = 'block');
        }

        // 외국어 사용자에게는 KR 교환코드, 카카오페이, 모달형 후원 숨김, 인라인 Ko-fi 표시
        const exchangeCodeSection = document.getElementById('exchange-code-section');
        const kakaoPayContainer = document.getElementById('kakao-pay-container');
        const donateInline = document.getElementById('donate-inline');
        const inlineText = document.getElementById('donation-inline-text');
        const donateButtonSection = donateButton ? donateButton.closest('.about-section') : null;
        const fanboxContainer = document.getElementById('fanbox-inline-container');

        if (currentLang !== 'kr') {
            if (exchangeCodeSection) {
                exchangeCodeSection.style.display = 'none';
            }
            if (kakaoPayContainer) {
                kakaoPayContainer.style.display = 'none';
            }
            if (donateInline) {
                donateInline.style.display = 'block';
            }
            if (donateButton) {
                donateButton.style.display = 'none';
            }
            if (donateButtonSection) {
                donateButtonSection.style.display = 'none';
            }

            if (inlineText) {
                inlineText.innerHTML = getI18nText('donationInlineText', inlineText.innerHTML || '');
            }
            if (fanboxContainer) {
                fanboxContainer.style.display = currentLang === 'jp' ? 'block' : 'none';
            }
        } else {
            if (exchangeCodeSection) exchangeCodeSection.style.display = '';
            if (kakaoPayContainer) kakaoPayContainer.style.display = '';
            if (donateInline) donateInline.style.display = 'none';
            if (donateButton) donateButton.style.display = '';
            if (donateButtonSection) donateButtonSection.style.display = '';
            if (fanboxContainer) fanboxContainer.style.display = 'none';
        }
    }

    // 언어별 SEO 설정 함수
        function updateSEOContent() {
        const currentLang = detectAboutLang();
        if (window.SeoEngine && typeof window.SeoEngine.setContextHint === 'function') {
            window.SeoEngine.setContextHint({
                domain: 'about',
                mode: 'list',
                lang: currentLang
            }, { rerun: true });
            return;
        }
        if (window.SeoEngine && typeof window.SeoEngine.run === 'function') {
            window.SeoEngine.run();
        }
    }

    document.addEventListener('DOMContentLoaded', async () => {
        Navigation.load('about');

        const currentLang = detectAboutLang();
        if (typeof initPageI18n === 'function') {
            await initPageI18n('about');
            if (typeof setLang === 'function') {
                await setLang(currentLang);
            }
        } else if (window.I18nService && typeof window.I18nService.init === 'function') {
            await window.I18nService.init('about', currentLang);
        }

        updateSEOContent();
        await updateLanguageContent();
        initializePageContent();
    });

    function initializePageContent() {

        // 교환코드 목록 (새로운 코드로 업데이트하려면 이 문자열만 수정하면 됩니다)
        const exchangeCodes = `14304377KZKKCHVG
23200694UEZZUPWC
83755731UGJITCAY
47051430UAYXCNRY
18709433UCINWXMY
57143774UDXPZRKV
72375714UMHLVPAL
83389695UNQTFVHN
18278154UINCXYGX
59040068UJPRBHZV
15899588UUMAKPIQ
31729574UVOVAFMA
10591569URLFCFTD
16354250USTKAURP
00590346UOCZBQYE
73419864UPSIGHLQ
30104424UXBXTUUH
16636701UYRNHDAK
56702754VEAPNJJI
17436638VFWLHPNP
88028922VAGTUZIS
86694769VBVCIJXL
15755961VDFRIDWU
59373610VLUAUECH
90275126VNEVRWKM
23298535VHKFRZBQ
38474464VIZKODCI
63954140VKIZWZZZ
27935360VUYIRBEQ
03003539VWHXXISH`;

        // 교환코드 동적 생성 함수
        function generateExchangeCodes() {
            const container = document.getElementById('exchangeCodesContainer');
            const codes = exchangeCodes.trim().split('\n').filter(code => code.trim() !== '');

            // 한 번에 모든 HTML을 생성하여 DOM 조작 최소화
            const codeItemsHTML = codes.map(code =>
                `<div class="code-item" data-code="${code.trim()}">${code.trim()}</div>`
            ).join('');

            container.innerHTML = codeItemsHTML;
        }

        // 클립보드 복사 함수
        function copyToClipboard(element, code) {
            navigator.clipboard.writeText(code).then(() => {
                // 복사 완료 피드백
                const originalText = element.textContent;

                element.classList.add('copied');
                element.textContent = getI18nText('copySuccessText', '복사됨!');

                setTimeout(() => {
                    element.classList.remove('copied');
                    element.textContent = originalText;
                }, 800);
            }).catch(err => {
                console.error('복사 실패:', err);
                // 복사 실패 시 폴백
                element.classList.add('copy-failed');
                element.textContent = getI18nText('copyFailedText', '복사 실패');
                setTimeout(() => {
                    element.classList.remove('copy-failed');
                    element.textContent = code;
                }, 800);
            });
        }

        // 이벤트 위임을 사용한 클릭 이벤트 처리
        function setupCodeClickHandler() {
            const container = document.getElementById('exchangeCodesContainer');
            container.addEventListener('click', function (e) {
                if (e.target.classList.contains('code-item')) {
                    const code = e.target.dataset.code;
                    copyToClipboard(e.target, code);
                }
            });
        }

        // 모달 관련 기능 (KR 전용)
        const donateModal = document.getElementById('donateModal');
        const donateBtn = document.getElementById('donateButton');
        const donateCloseButton = document.querySelector('#donateModal .close-button');

        // 카카오페이 모달 관련 기능
        const kakaoPayModal = document.getElementById('kakaoPayModal');
        const kakaoPayBtn = document.getElementById('kakaoPayButton');
        const kakaoCloseButton = document.querySelector('#kakaoPayModal .close-button');

        // 교환코드 모달 관련 기능
        const exchangeCodeModal = document.getElementById('exchangeCodeModal');
        const exchangeCodeBtn = document.getElementById('exchangeCodeButton');
        const exchangeCloseButton = document.querySelector('#exchangeCodeModal .close-button');

        // 이벤트 핸들러 초기화 (한 번만 실행)
        let isCodeHandlerSetup = false;

        // 언어에 따라 후원 방식 분기
        const currentLang = detectAboutLang();
        if (currentLang === 'kr') {
            if (donateBtn && donateModal) {
                donateBtn.onclick = function () {
                    donateModal.style.display = 'block';
                }
            }
        } else {
            // EN/JP: 인라인 Ko-fi 렌더링 (필요 시 스크롤)
            renderKoFiInline();
            if (donateBtn) {
                donateBtn.onclick = function () {
                    const inline = document.getElementById('donate-inline');
                    if (inline) inline.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }
            }
        }

        if (donateCloseButton && donateModal) {
            donateCloseButton.onclick = function () {
                donateModal.style.display = 'none';
            }
        }

        if (kakaoPayBtn && donateModal && kakaoPayModal) {
            kakaoPayBtn.onclick = function () {
                donateModal.style.display = 'none';
                kakaoPayModal.style.display = 'block';
            }
        }

        if (kakaoCloseButton && kakaoPayModal) {
            kakaoCloseButton.onclick = function () {
                kakaoPayModal.style.display = 'none';
            }
        }

        if (exchangeCodeBtn && exchangeCodeModal) {
            exchangeCodeBtn.onclick = function () {
                exchangeCodeModal.style.display = 'block';
                generateExchangeCodes();
                if (!isCodeHandlerSetup) {
                    setupCodeClickHandler();
                    isCodeHandlerSetup = true;
                }
            }
        }

        if (exchangeCloseButton && exchangeCodeModal) {
            exchangeCloseButton.onclick = function () {
                exchangeCodeModal.style.display = 'none';
            }
        }

        window.onclick = function (event) {
            if (donateModal && event.target == donateModal) {
                donateModal.style.display = 'none';
            }
            if (kakaoPayModal && event.target == kakaoPayModal) {
                kakaoPayModal.style.display = 'none';
            }
            if (exchangeCodeModal && event.target == exchangeCodeModal) {
                exchangeCodeModal.style.display = 'none';
            }
        }

        // Ko-fi 인라인 렌더링 (스크립트 로드 금지: body 덮어쓰는 문제 방지)
        function renderKoFiInline() {
            const container = document.getElementById('kofiInline');
            if (!container) return;
            container.innerHTML = `
                        <div class="btn-container">
                            <a title="Support me on ko-fi.com" class="kofi-button" style="background-color:#72a4f2; display:inline-block; padding:8px 12px; border-radius:6px; color:#fff; text-decoration:none; font-weight:600;"
                               href="https://ko-fi.com/S6S11F0PUN" target="_blank" rel="noopener">
                                <span class="kofitext" style="display:inline-flex; align-items:center; gap:6px;">
                                    <img src="https://storage.ko-fi.com/cdn/cup-border.png" alt="Ko-fi donations" class="kofiimg" style="height:18px; vertical-align:middle;">
                                    Support me on Ko-fi
                                </span>
                            </a>
                        </div>`;
        }

        let allUpdates = [];
        const MAX_TOTAL_LINES = 10;

        async function loadUpdates() {
            const updateList = document.getElementById('recent-update-list');
            const showMoreBtn = document.getElementById('show-more-updates-btn');
            if (!updateList || !showMoreBtn) return;

            try {
                const configuredPath = (typeof window.APP_UPDATES_CSV_PATH === 'string')
                    ? window.APP_UPDATES_CSV_PATH.trim()
                    : '';
                const updatesPath = configuredPath || '/assets/version/updates.csv';
                const rawUpdatesUrl = /^https?:\/\//i.test(updatesPath)
                    ? updatesPath
                    : `${BASE_URL}${updatesPath.startsWith('/') ? updatesPath : `/${updatesPath}`}`;
                const updatesUrl = (window.VersionRuntime && typeof window.VersionRuntime.assetUrl === 'function')
                    ? window.VersionRuntime.assetUrl(rawUpdatesUrl)
                    : `${rawUpdatesUrl}?v=${APP_VERSION}`;

                const response = await fetch(updatesUrl);
                const data = await response.text();
                allUpdates = data.split('\n')
                    .slice(1)
                    .filter(line => line.trim())
                    .map(line => {
                        const parts = line.split(',');
                        if (parts.length < 3) return null;
                        const [date, version, content] = parts;

                        // content가 undefined이거나 비어있는 경우 처리
                        if (!content) return null;

                        const formattedDate = date.replace(/^20/, '');
                        return { date: formattedDate, version, content: content.replace('|', ', ') };
                    })
                    .filter(item => item !== null);

                showMoreUpdates();

                showMoreBtn.style.display = 'block';
                showMoreBtn.addEventListener('click', () => {
                    showMoreBtn.style.display = 'none';
                    showAllUpdates();
                });
            } catch (error) {
                console.error('Failed to load update history:', error);
            }
        }

        function showAllUpdates() {
            const updateList = document.getElementById('recent-update-list');
            if (!updateList) return;
            updateList.innerHTML = '';

            allUpdates.forEach(update => {
                const updateElement = document.createElement('div');
                updateElement.className = 'recent-update-content-text';

                const contentLines = update.content.split('\\n').join('<br>');
                updateElement.innerHTML = `
                            <div class="date">${update.date}</div>
                            <div class="version">${update.version}</div>
                            <div class="content"><p>${contentLines}</p></div>
                        `;
                updateList.appendChild(updateElement);
            });
        }

        function showMoreUpdates() {
            const updateList = document.getElementById('recent-update-list');
            if (!updateList) return;
            updateList.innerHTML = '';
            let totalLines = 0;

            for (const update of allUpdates) {
                const lines = update.content.split('\\n');
                if (totalLines + lines.length > MAX_TOTAL_LINES) {
                    const remainingLines = MAX_TOTAL_LINES - totalLines;
                    if (remainingLines > 0) {
                        const updateElement = document.createElement('div');
                        updateElement.className = 'recent-update-content-text';
                        const visibleContent = lines.slice(0, remainingLines).join('<br>');
                        updateElement.innerHTML = `
                                    <div class="date">${update.date}</div>
                                    <div class="version">${update.version}</div>
                                    <div class="content"><p>${visibleContent} ...</p></div>
                                `;
                        updateList.appendChild(updateElement);
                    }
                    break;
                }

                const updateElement = document.createElement('div');
                updateElement.className = 'recent-update-content-text';
                updateElement.innerHTML = `
                            <div class="date">${update.date}</div>
                            <div class="version">${update.version}</div>
                            <div class="content"><p>${lines.join('<br>')}</p></div>
                        `;
                updateList.appendChild(updateElement);
                totalLines += lines.length;
                if (totalLines >= MAX_TOTAL_LINES) break;
            }
        }

        loadUpdates();
    } // initializePageContent 함수 종료
</script>
