---
layout: default
custom_css: [position-tiers]
custom_js: [translation-loader]
custom_data: [characters/characters.js]
permalink: /tier/position-tier/
language: kr
title: 페르소나5 더 팬텀 X 루페르넷 - 티어 리스트
description: P5X 랭커의 티어 리스트를 확인하세요.
---

<link
rel="stylesheet"
href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
/>

<script type="module" src="../position-tiers.js?v=${APP_VERSION}"></script>

 <!-- Main content -->
<div class="main-wrapper">
    <!-- 언어 안내 메시지 -->
    <div id="language-notice" class="language-notice" style="display: none;">
        <p id="language-notice-text"></p>
    </div>
    
    <!-- Navigation path -->
    <div class="navigation-path">
        <script>document.write(`<a href="../../?v=${APP_VERSION}" id="nav-home">홈</a>`);</script>
        <span class="separator">/</span>
        <span class="current-page" id="nav-current">티어 메이커</span>
    </div>
    <div class="header-container">
        <h1 id="page-title">티어 메이커</h1>
    </div>
    
    <!-- Filter section -->
    <div class="filter-section">
        <div class="filter-header">
            <button class="filter-toggle-btn">
                <img src="{{ site.baseurl }}/assets/img/character-cards/filter.png" alt="필터" />
                <span></span>
            </button>
            <button class="filter-reset-btn" style="display: none;">
                <img src="{{ site.baseurl }}/assets/img/character-cards/reset.png" alt="초기화" />
            </button>
        </div>
        
        <div class="filter-content" style="display: none;">
            <!-- Element filter -->
            <div class="filter-group">
                <h3 id="filter-element-title">속성</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="element" value="물리">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_물리.png" alt="물리">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="총격">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_총격.png" alt="총격">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="화염">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_화염.png" alt="화염">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="빙결">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_빙결.png" alt="빙결">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="전격">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_전격.png" alt="전격">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="질풍">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_질풍.png" alt="질풍">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="염동">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_염동.png" alt="염동">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="핵열">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_핵열.png" alt="핵열">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="축복">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_축복.png" alt="축복">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="주원">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_주원.png" alt="주원">
                        <span></span>
                    </label>
                    <label>
                        <input type="checkbox" name="element" value="만능">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/속성_만능.png" alt="만능">
                        <span></span>
                    </label>
                </div>
            </div>
            
            <!-- Position filter -->
            <div class="filter-group">
                <h3 id="filter-position-title">직업</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="position" value="지배">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_지배.png" alt="지배">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="반항">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_반항.png" alt="반항">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="우월">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_우월.png" alt="우월">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="굴복">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_굴복.png" alt="굴복">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="방위">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_방위.png" alt="방위">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="구원">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_구원.png" alt="구원">
                    </label>
                    <label>
                        <input type="checkbox" name="position" value="해명">
                        <img src="{{ site.baseurl }}/assets/img/character-cards/직업_해명.png" alt="해명">
                    </label>
                </div>
            </div>
            
            <!-- Rarity filter -->
            <div class="filter-group">
                <h3 id="filter-rarity-title">유형</h3>
                <div class="filter-options">
                    <label>
                        <input type="checkbox" name="rarity" value="5" hidden>
                        <div class="star-container">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star5.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star5.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star5.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star5.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star5.png" alt="★">
                        </div>
                    </label>
                    <label>
                        <input type="checkbox" name="rarity" value="4" hidden>
                        <div class="star-container">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star4.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star4.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star4.png" alt="★">
                            <img src="{{ site.baseurl }}/assets/img/character-detail/star4.png" alt="★">
                        </div>
                    </label>
                </div>
            </div>

            <!-- Tag filter -->
            <!--
            <div class="filter-group">
                <h3 id="filter-tag-title">태그</h3>
                <div class="filter-options tag-options">
                    <label><input type="checkbox" name="tag" value="TECHNICAL"><span>TECHNICAL</span></label>
                    <label><input type="checkbox" name="tag" value="추가효과"><span>추가 효과</span></label>
                    <label><input type="checkbox" name="tag" value="지속대미지"><span>지속 대미지</span></label>
                    <label><input type="checkbox" name="tag" value="방어력감소"><span>방어력 감소</span></label>
                    <label><input type="checkbox" name="tag" value="관통"><span>관통</span></label>
                    <label><input type="checkbox" name="tag" value="효과명중"><span>효과 명중</span></label>
                    <label><input type="checkbox" name="tag" value="실드"><span>실드</span></label>
                    <label><input type="checkbox" name="tag" value="화상"><span>화상</span></label>
                    <label><input type="checkbox" name="tag" value="풍습"><span>풍습</span></label>
                    <label><input type="checkbox" name="tag" value="감전"><span>감전</span></label>
                    <label><input type="checkbox" name="tag" value="동결"><span>동결</span></label>
                </div>
            </div>
            -->
        </div>
    </div>

    <!-- Separator line -->
    <div class="separator-line"></div>

    <!-- Tier Criteria Section (only shown in Tier List mode) -->
    <div id="tier-criteria-section" class="tier-criteria-section" style="display: none;">
        <div class="tier-criteria-toggle">
            <button id="tier-criteria-btn" class="tier-criteria-button">
                <span id="tier-criteria-title">티어 기준</span>
                <span class="tier-criteria-arrow">▼</span>
            </button>
        </div>
        <div id="tier-criteria-content" class="tier-criteria-content" style="display: none;">
            <!-- Korean -->
            <div class="tier-criteria-text kr-text">
                <ul>
                    <li>lufel.net 제작자가 작성한 티어입니다. 개인 별로 기준은 다를 수 있으므로, 참고 및 재미로만 봐주세요.</li>
                    <li>LV80, 모든 스킬 레벨 등 의식을 제외한 모든 값이 기본적으로 세팅돼있는 경우를 말합니다.</li>
                    <li>경쟁 콘텐츠를 중심으로 작성됐으며, 버전 업데이트에 따라 티어는 지속적으로 변동될 수 있습니다.</li>
                </ul>
            </div>
            <!-- English -->
            <div class="tier-criteria-text en-text" style="display: none;">
                <ul>
                    <li>This tier list is created by the lufel.net. Individual standards may vary, so please use it for reference and entertainment only.</li>
                    <li>Assumes LV80, all skill levels, and all values are basically set except for Awareness.</li>
                    <li>Written with competitive content in mind, tiers may continuously change with version updates.</li>
                    <li>Global servers may differ from KR tiers because characters are buffed.</li>
                </ul>
            </div>
            <!-- Japanese -->
            <div class="tier-criteria-text jp-text" style="display: none;">
                <ul>
                    <li>このティアリストはlufel.netが作成したものです。個人によって基準は異なる場合がありますので、参考と娯楽としてのみご覧ください。</li>
                    <li>LV80、すべてのスキルレベルなど、意識（Awareness）を除くすべての値が基本的に設定されている場合を指します。</li>
                    <li>競争コンテンツを中心に作成されており、バージョンアップデートによってティアは継続的に変動する可能性があります。</li>
                    <li>グローバルサーバーは怪盗がバフされているため、KRティアとは異なる場合があります。</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Tier Source Toggle Section (separate from Tier Criteria) -->
    <div id="tier-source-toggle" class="tier-source-toggle" style="display:none;">
        <div style="display:flex; gap:8px; align-items:center;">
            <button id="btn-global-tier" class="tier-source-btn" style="padding:6px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); cursor:pointer;">Global</button>
            <button id="btn-kr-tier" class="tier-source-btn" style="padding:6px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); cursor:pointer;">GLB on KR</button>
            <button id="btn-kr-spoiler-tier" class="tier-source-btn" style="padding:6px 10px; border-radius:6px; border:1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.08); color: rgba(255,255,255,0.9); cursor:pointer;">[Spoiler] KR</button>
        </div>
    </div>

    <!-- Position Tier Container -->
    <div class="position-tiers-container">
        <!-- Header Row -->
        <div class="tier-header-cell">lufel.net</div>
        <!-- Position Headers will be populated by JavaScript -->
        <div class="settings-header-cell"></div>
        
        <!-- Tier Rows will be populated by JavaScript -->
    </div>

    <!-- Character Pool -->
    <div class="cards container">
    </div>
    
    <!-- Help Text -->
    <div class="help-text">
        <p id="help-message">* 캐릭터 이동이 안될 경우 캐릭터를 더블 클릭해서 아래 리스트로 이동한 뒤 일정 시간 뒤 다시 시도해주세요.</p>
    </div>

    <!-- Settings Modal -->
    <dialog class="settings-modal">
        <section>
            <div class="colors"></div>
            <textarea class="tier-label" placeholder="Tier label"></textarea>
            <button id="delete">Delete Row</button>
            <button id="clear">Clear Row</button>
            <button id="prepend">Add a Row Above</button>
            <button id="append">Add a Row Below</button>
        </section>
    </dialog>
    
    <!-- Ritual Modal -->
    <dialog class="ritual-modal">
        <div class="ritual-modal-content">
            <div class="ritual-modal-header">
                <h3>Awareness</h3>
                <button class="ritual-modal-close">&times;</button>
            </div>
            <div class="ritual-options">
                <div class="ritual-option" data-ritual="none">
                    <div class="ritual-none">NONE</div>
                </div>
                <div class="ritual-option" data-ritual="num1">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num1.png" alt="Ritual 1">
                </div>
                <div class="ritual-option" data-ritual="num2">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num2.png" alt="Ritual 2">
                </div>
                <div class="ritual-option" data-ritual="num3">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num3.png" alt="Ritual 3">
                </div>
                <div class="ritual-option" data-ritual="num4">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num4.png" alt="Ritual 4">
                </div>
                <div class="ritual-option" data-ritual="num5">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num5.png" alt="Ritual 5">
                </div>
                <div class="ritual-option" data-ritual="num6">
                    <img src="{{ site.baseurl }}/assets/img/ritual/num6.png" alt="Ritual 6">
                </div>
            </div>
        </div>
    </dialog>
    
    <div style="height: 24px;"></div>
    
    <div id="ad-unit-bottom" class="AD-bottom" style="text-align: center; align-items: center; display: flex; justify-content: center;"> 
    <ins class="adsbygoogle"
        style="display:inline-block;width:970px;height:90px"
        data-ad-client="ca-pub-5862324369257695"
        data-ad-slot="9244892982"></ins>
    </div>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({});
    </script>
    <div style="height: 12px;"></div>
    <style>
        @media (max-width: 1440px) {
            .AD-bottom {
                display: none !important;
            }
        }
    </style>

</div>

<script>
    // 다국어 지원 함수
    async function updateLanguageContent() {
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // Jekyll 다국어 데이터 사용
        const i18nData = {
            kr: {
                language_notice: "",
                nav_home: "홈",
                nav_current: "티어 메이커",
                page_title: "티어 메이커",
                filter_element: "속성",
                filter_position: "직업",
                filter_rarity: "유형",
                filter_tag: "태그",
                help_message: "* 캐릭터를 더블클릭하면 의식을 설정할 수 있습니다."
            },
            en: {
                language_notice: "",
                nav_home: "{{ site.data.i18n.en.nav_home | default: 'Home' }}",
                nav_current: "{{ site.data.i18n.en.position_tier_maker | default: 'Position Tier Maker' }}",
                page_title: "{{ site.data.i18n.en.position_tier_maker_title | default: 'Position Tier Maker' }}",
                filter_element: "{{ site.data.i18n.en.filter_element | default: 'Element' }}",
                filter_position: "{{ site.data.i18n.en.filter_position | default: 'Position' }}",
                filter_rarity: "{{ site.data.i18n.en.filter_rarity | default: 'Type' }}",
                filter_tag: "{{ site.data.i18n.en.filter_tag | default: 'Tag' }}",
                help_message: "* Double-click the character to set the Awareness."
            },
            jp: {
                language_notice: "",
                nav_home: "{{ site.data.i18n.jp.nav_home | default: 'ホーム' }}",
                nav_current: "{{ site.data.i18n.jp.position_tier_maker | default: 'ポジションティアメーカー' }}",
                page_title: "{{ site.data.i18n.jp.position_tier_maker_title | default: 'ポジションティアメーカー' }}",
                filter_element: "{{ site.data.i18n.jp.filter_element | default: '属性' }}",
                filter_position: "{{ site.data.i18n.jp.filter_position | default: '職業' }}",
                filter_rarity: "{{ site.data.i18n.jp.filter_rarity | default: 'タイプ' }}",
                filter_tag: "{{ site.data.i18n.jp.filter_tag | default: 'タグ' }}",
                help_message: "* 怪盗をダブルクリックして意識を設定してください。"
            }
        };
        
        const data = i18nData[currentLang];
        if (!data) return;
        
        // 언어 안내 메시지
        if (currentLang !== 'kr') {
            const notice = document.getElementById('language-notice');
            const noticeText = document.getElementById('language-notice-text');
            if (notice && noticeText && data.language_notice) {
                noticeText.textContent = data.language_notice;
                notice.style.display = 'block';
            }
        }
        
        // list 파라미터 확인
        const urlParams = new URLSearchParams(window.location.search);
        const isListMode = urlParams.get('list') !== 'false';
        
        // 네비게이션 및 제목 업데이트
        const navHome = document.getElementById('nav-home');
        const navCurrent = document.getElementById('nav-current');
        const pageTitle = document.getElementById('page-title');
        
        if (navHome) navHome.textContent = data.nav_home;
        
        // 언어별 제목 데이터
        const titleTexts = {
            'kr': { tierList: '티어 리스트', tierMaker: '티어 메이커' },
            'en': { tierList: 'Tier List', tierMaker: 'Tier Maker' },
            'jp': { tierList: 'ティアリスト', tierMaker: 'ティアメーカー' }
        };
        
        const currentTitleTexts = titleTexts[currentLang] || titleTexts['kr'];
        
        // list=false일 때 제목 변경
        if (isListMode) {
            // 티어 리스트 모드
            if (navCurrent) navCurrent.textContent = currentTitleTexts.tierList;
            if (pageTitle) pageTitle.textContent = currentTitleTexts.tierList;
        } else {
            // 티어 메이커 모드
            if (navCurrent) navCurrent.textContent = currentTitleTexts.tierMaker;
            if (pageTitle) pageTitle.textContent = currentTitleTexts.tierMaker;
        }
        
        // 필터 제목 업데이트
        const filterElementTitle = document.getElementById('filter-element-title');
        const filterPositionTitle = document.getElementById('filter-position-title');
        const filterRarityTitle = document.getElementById('filter-rarity-title');
        const filterTagTitle = document.getElementById('filter-tag-title');
        
        if (filterElementTitle) filterElementTitle.textContent = data.filter_element;
        if (filterPositionTitle) filterPositionTitle.textContent = data.filter_position;
        if (filterRarityTitle) filterRarityTitle.textContent = data.filter_rarity;
        if (filterTagTitle) filterTagTitle.textContent = data.filter_tag;
        
        // 도움말 메시지 업데이트
        const helpMessage = document.getElementById('help-message');
        if (helpMessage) helpMessage.textContent = data.help_message;
        
        // 티어 기준 섹션 표시/숨김 및 언어 업데이트
        const tierCriteriaSection = document.getElementById('tier-criteria-section');
        if (tierCriteriaSection) {
            if (isListMode) {
                // 티어 리스트 모드일 때 표시
                tierCriteriaSection.style.display = 'block';
                updateTierCriteriaLanguage(currentLang);
            } else {
                // 티어 메이커 모드일 때는 숨김
                tierCriteriaSection.style.display = 'none';
            }
        }

        // 티어 소스 토글 섹션 노출/라벨 현지화 (en/jp 전용)
        const sourceToggle = document.getElementById('tier-source-toggle');
        const btnGlobal = document.getElementById('btn-global-tier');
        const btnKR = document.getElementById('btn-kr-tier');
        const btnKRSpoiler = document.getElementById('btn-kr-spoiler-tier');
        if (sourceToggle && btnGlobal && btnKR && btnKRSpoiler) {
            // 리스트 모드(보기)에서만 노출, 메이커(list=false)에서는 숨김
            if (isListMode && (currentLang === 'en' || currentLang === 'jp')) {
                sourceToggle.style.display = 'block';
                if (currentLang === 'en') {
                    btnGlobal.textContent = 'Global';
                    btnKR.textContent = 'GLB on KR';
                    btnKRSpoiler.textContent = '[Spoiler] KR';
                } else {
                    btnGlobal.textContent = 'グローバル';
                    btnKR.textContent = 'グローバル(韓国版)';
                    btnKRSpoiler.textContent = '[ネタバレ] 韓国版';
                }
            } else {
                sourceToggle.style.display = 'none';
            }
        }
        
        // 태그 필터 번역
        await updateTagFilterTranslations(currentLang);
    }
    
    // 티어 기준 언어 업데이트 함수
    function updateTierCriteriaLanguage(currentLang) {
        // 제목 업데이트
        const tierCriteriaTitle = document.getElementById('tier-criteria-title');
        if (tierCriteriaTitle) {
            if (currentLang === 'en') {
                tierCriteriaTitle.textContent = 'Tier Criteria';
            } else if (currentLang === 'jp') {
                tierCriteriaTitle.textContent = 'ティア基準';
            } else {
                tierCriteriaTitle.textContent = '티어 기준';
            }
        }
        
        // 언어별 텍스트 표시/숨김
        const krText = document.querySelector('.tier-criteria-text.kr-text');
        const enText = document.querySelector('.tier-criteria-text.en-text');
        const jpText = document.querySelector('.tier-criteria-text.jp-text');
        
        if (krText) krText.style.display = currentLang === 'kr' ? 'block' : 'none';
        if (enText) enText.style.display = currentLang === 'en' ? 'block' : 'none';
        if (jpText) jpText.style.display = currentLang === 'jp' ? 'block' : 'none';
    }
    
    // 티어 기준 토글 기능 초기화
    function initTierCriteriaToggle() {
        const tierCriteriaBtn = document.getElementById('tier-criteria-btn');
        const tierCriteriaContent = document.getElementById('tier-criteria-content');
        const tierCriteriaArrow = document.querySelector('.tier-criteria-arrow');
        
        if (tierCriteriaBtn && tierCriteriaContent) {
            tierCriteriaBtn.addEventListener('click', function() {
                const isVisible = tierCriteriaContent.style.display !== 'none';
                
                if (isVisible) {
                    tierCriteriaContent.style.display = 'none';
                    if (tierCriteriaArrow) tierCriteriaArrow.textContent = '▼';
                } else {
                    tierCriteriaContent.style.display = 'block';
                    if (tierCriteriaArrow) tierCriteriaArrow.textContent = '▲';
                }
            });
        }
    }
    
    // 태그 필터 번역 함수
    async function updateTagFilterTranslations(currentLang) {
        if (currentLang === 'kr') return;
        
        const tagTranslations = {
            'en': {
                'TECHNICAL': 'TECHNICAL',
                '추가 효과': 'Additional Effect',
                '지속 대미지': 'Damage over Time',
                '방어력 감소': 'Defense Reduction',
                '관통': 'Pierce Rate',
                '효과 명중': 'Effect Accuracy',
                '실드': 'Shield',
                '화상': 'Burn',
                '풍습': 'Windswept',
                '감전': 'Shock',
                '동결': 'Freeze'
            },
            'jp': {
                'TECHNICAL': 'TECHNICAL',
                '추가 효과': '追加効果',
                '지속 대미지': '持続ダメージ',
                '방어력 감소': '防御力減少',
                '관통': '貫通',
                '효과 명중': '状態異常命中',
                '실드': 'シールド',
                '화상': '火傷',
                '풍습': '風習',
                '감전': '感電',
                '동결': '凍結'
            }
        };
        
        const translations = tagTranslations[currentLang];
        if (!translations) return;
        
        // 태그 필터가 주석 처리되어 있으므로 특정 ID로 찾기
        const tagFilterGroup = document.getElementById('filter-tag-title')?.closest('.filter-group');
        if (tagFilterGroup) {
            const tagOptions = tagFilterGroup.querySelectorAll('.filter-options label span');
            tagOptions.forEach(span => {
                const originalText = span.textContent;
                if (translations[originalText]) {
                    span.textContent = translations[originalText];
                }
            });
            
            // 영어/일본어일 때 태그 필터 숨기기 (주석 처리되어 있으므로 실제로는 숨길 필요 없음)
            if (currentLang === 'en' || currentLang === 'jp') {
                tagFilterGroup.style.display = 'none';
            }
        }
    }
    
    // 스크립트에서 데이터 추출하는 함수
    function extractDataFromScript(scriptText) {
        // characterData와 characterList를 추출하는 정규식
        const characterDataMatch = scriptText.match(/const characterData = ({[\s\S]*?});/);
        const characterListMatch = scriptText.match(/const characterList = ({[\s\S]*?});/);
        
        if (!characterDataMatch || !characterListMatch) {
            throw new Error('Failed to extract data from script');
        }
        
        // JSON으로 파싱하기 위해 Function 생성자 사용
        const characterData = new Function('return ' + characterDataMatch[1])();
        const characterList = new Function('return ' + characterListMatch[1])();
        
        return { characterData, characterList };
    }

    // 언어별 캐릭터 데이터 로딩 및 병합
    // listLangOverride: 'kr'를 전달하면 캐릭터 리스트는 KR 기준 사용 (표시 이름은 현재 언어 우선)
    async function loadCharacterData(listLangOverride) {
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        try {
            // 1. 한국어 데이터 로딩 (기본 데이터)
            const krResponse = await fetch(`/data/kr/characters/characters.js?v=${APP_VERSION}`);
            if (!krResponse.ok) {
                throw new Error('Failed to load KR character data');
            }
            
            const krScriptText = await krResponse.text();
            const { characterData: krCharacterData, characterList: krCharacterList } = extractDataFromScript(krScriptText);

            
            // 2. 언어별 데이터 로딩 (한국어가 아닌 경우)
            if (currentLang !== 'kr') {
                const langUrl = `/data/${currentLang}/characters/characters.js?v=${APP_VERSION}`;
                
                const langResponse = await fetch(langUrl);
                
                if (langResponse.ok) {
                    const langScriptText = await langResponse.text();
                    
                    const { characterData: langCharacterData, characterList: langCharacterList } = extractDataFromScript(langScriptText);
                    
                    // 3. 데이터 병합 (KR 전체 키 기준으로 병합, 언어 데이터 있으면 덮어쓰기)
                    const mergedData = mergeCharacterData(krCharacterData, langCharacterData);

                    // 전역 변수 설정:
                    // - kr_spoiler(override='kr'): KR 리스트 강제 사용
                    // - 그렇지 않으면 현재 언어 리스트 사용, 없으면 KR 리스트
                    window.characterData = mergedData;
                    window.characterList = (listLangOverride === 'kr') ? krCharacterList : (langCharacterList || krCharacterList);
                    
                } else {
                    //console.log('❌ Language data not found, using KR data. Status:', langResponse.status);
                    // 언어별 데이터가 없으면 한국어 데이터 사용
                    window.characterData = krCharacterData;
                    window.characterList = krCharacterList;
                }
            } else {
                // 한국어인 경우 그대로 사용
                window.characterData = krCharacterData;
                window.characterList = krCharacterList;
            }

            // 4. characterList가 변경되었으므로, 전역 캐시/파생 데이터 초기화 보조
            try {
                window.characterListUpdatedAt = Date.now();
            } catch(_) {}
            
            return true;
            
        } catch (error) {
            console.error('Failed to load character data:', error);
            return false;
        }
    }

    // 외부에서 리스트 소스 오버라이드로 재로딩할 수 있도록 전역 노출
    window.loadCharacterDataForTierSource = async function(listLangOverride){
        return await loadCharacterData(listLangOverride);
    }
    
    // 캐릭터 데이터 병합 함수
    function mergeCharacterData(krData, langData) {
        // KR 전체를 기본으로 두고, 언어 데이터가 존재하는 항목만 필요한 필드를 덮어쓴다
        const mergedData = {};
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';

        // 1) KR 데이터 전부 복사
        Object.keys(krData || {}).forEach(key => {
            mergedData[key] = { ...krData[key] };
        });

        // 2) 언어 데이터가 제공되면 필요한 필드만 덮어쓰기
        Object.keys(langData || {}).forEach(characterKey => {
            const krChar = krData[characterKey];
            const langChar = langData[characterKey];
            if (!krChar) return; // KR에 없는 키는 무시

            // 이름 현지화: KR 데이터에 별도 현지화 필드가 있으면 우선, 없으면 언어 데이터의 name
            if (currentLang === 'en') {
                if (krChar.name_en) mergedData[characterKey].name = krChar.name_en;
                else if (langChar?.name) mergedData[characterKey].name = langChar.name;
            } else if (currentLang === 'jp') {
                if (krChar.name_jp) mergedData[characterKey].name = krChar.name_jp;
                else if (langChar?.name) mergedData[characterKey].name = langChar.name;
            }

            // 보조 필드 덮어쓰기 (값이 있을 때만)
            if (langChar?.role) mergedData[characterKey].role = langChar.role;
            if (langChar?.tag) mergedData[characterKey].tag = langChar.tag;
            if (typeof langChar?.release_order !== 'undefined' && langChar.release_order !== 0) {
                mergedData[characterKey].release_order = langChar.release_order;
            }
        });

        return mergedData;
    }
    
    // 언어별 SEO 설정 함수
    function updateSEOContent() {
        const currentLang = typeof LanguageRouter !== 'undefined' ? LanguageRouter.getCurrentLanguage() : 'kr';
        
        // URL 파라미터 확인
        const urlParams = new URLSearchParams(window.location.search);
        const shouldLoadList = urlParams.get('list') !== 'false';
        
        const seoData = {
            'kr': shouldLoadList ? {
                title: '티어 리스트 - 페르소나5 더 팬텀 X 루페르넷',
                description: 'P5X 캐릭터 포지션별 티어 리스트를 확인하세요.'
            } : {
                title: '티어 메이커 - 페르소나5 더 팬텀 X 루페르넷',
                description: '포지션별로 P5X 캐릭터 티어 리스트를 만들어 보세요.'
            },
            'en': shouldLoadList ? {
                title: 'Tier List - Persona 5: The Phantom X LufelNet',
                description: 'Check P5X character tier list by position.'
            } : {
                title: 'Tier Maker - Persona 5: The Phantom X LufelNet',
                description: 'Create your own P5X character tier list by position.'
            },
            'jp': shouldLoadList ? {
                title: 'ティアリスト - ペルソナ5 ザ・ファントム X LufelNet',
                description: 'P5X怪盗のポジション別ティアリストを確認してください。'
            } : {
                title: 'ティアメーカー - ペルソナ5 ザ・ファントム X LufelNet',
                description: 'ポジション別にP5X怪盗ティアを作ってみましょう。'
            }
        };
        
        const currentSEO = seoData[currentLang] || seoData['kr'];
        
        // 타이틀 업데이트
        document.title = currentSEO.title;
        
        // 메타 태그 업데이트
        const metaDescription = document.querySelector('meta[name="description"]');
        const ogTitle = document.querySelector('meta[property="og:title"]');
        const ogDescription = document.querySelector('meta[property="og:description"]');
        
        if (metaDescription) metaDescription.setAttribute('content', currentSEO.description);
        if (ogTitle) ogTitle.setAttribute('content', currentSEO.title);
        if (ogDescription) ogDescription.setAttribute('content', currentSEO.description);
    }
    
    // 중복 실행 방지를 위한 플래그
    let isInitializing = false;
    let isInitialized = false;

    async function initializePageContent() {
        // 중복 실행 방지
        if (isInitializing || isInitialized) {
            //console.log('initializePageContent already running or completed');
            return;
        }
        
        isInitializing = true;
        
        // 캐릭터 데이터 로딩
        const dataLoaded = await loadCharacterData();
        if (!dataLoaded || typeof window.characterData === 'undefined') {
            console.error('characterData is not loaded');
            isInitializing = false;
            return;
        }
        

        // 포지션별 티어 메이커 초기화 (position-tiers.js에서 정의된 함수)
        if (typeof window.initPositionTierMaker === 'function') {
            window.initPositionTierMaker();
        } else {
            console.error('initPositionTierMaker function not found');
        }
        
        // 초기화 완료
        isInitializing = false;
        isInitialized = true;
    }
    
    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', async () => {
        //console.log('DOMContentLoaded event fired');
        
        // 기본 초기화 작업
        Navigation.load('position-tier-maker');
        
        // 티어 기준 토글 기능 초기화
        initTierCriteriaToggle();
        
        // SEO 설정 업데이트
        updateSEOContent();
        
        // 언어 라우터 초기화 및 콘텐츠 업데이트
        if (typeof LanguageRouter !== 'undefined') {
            // 언어 파라미터 체크
            const hasLangParam = window.location.search.includes('lang=');
            if (hasLangParam) {
                // 언어 파라미터가 있으면 바로 콘텐츠 로드
                await updateLanguageContent();
                await initializePageContent();
            } else {
                // 언어 파라미터가 없으면 기본 한국어로 설정
                const currentUrl = new URL(window.location);
                currentUrl.searchParams.set('lang', 'kr');
                window.history.replaceState({}, '', currentUrl);
                
                await updateLanguageContent();
                await initializePageContent();
            }
        } else {
            await updateLanguageContent();
            await initializePageContent();
        }

        // 티어 소스 버튼 이벤트 연결 (en/jp 전용)
        const btnGlobal = document.getElementById('btn-global-tier');
        const btnKR = document.getElementById('btn-kr-tier');
        const btnKRSpoiler = document.getElementById('btn-kr-spoiler-tier');
        const setActive = (which) => {
            if (!btnGlobal || !btnKR || !btnKRSpoiler) return;
            const applyActive = (el, active) => {
                el.style.background = active ? 'rgba(255,255,255,0.18)' : 'rgba(255,255,255,0.08)';
                el.style.borderColor = active ? 'rgba(255,255,255,0.35)' : 'rgba(255,255,255,0.2)';
            };
            applyActive(btnGlobal, which === 'global');
            applyActive(btnKR, which === 'kr');
            applyActive(btnKRSpoiler, which === 'kr_spoiler');
        };
        if (btnGlobal && btnKR && btnKRSpoiler) {
            // 기본값: Global 활성화
            setActive('global');
            btnGlobal.addEventListener('click', async () => {
                setActive('global');
                if (typeof window.setTierSource === 'function') await window.setTierSource('global');
            });
            btnKR.addEventListener('click', async () => {
                setActive('kr');
                if (typeof window.setTierSource === 'function') await window.setTierSource('kr');
            });
            btnKRSpoiler.addEventListener('click', async () => {
                setActive('kr_spoiler');
                if (typeof window.setTierSource === 'function') await window.setTierSource('kr_spoiler');
            });
        }
    });
    
    // 추가 안전장치
    window.addEventListener('load', async () => {
        //console.log('Window load event fired');
        if (!isInitialized) {
            //console.log('Page not initialized yet, running initialization...');
            await initializePageContent();
        }
    });
</script> 