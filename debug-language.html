<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì–¸ì–´ ê°ì§€ ë””ë²„ê¹…</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 800px; 
            margin: 50px auto; 
            padding: 20px;
            background: #f5f5f5;
        }
        .debug-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover { background: #0056b3; }
        pre {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.info { background: #d1ecf1; color: #0c5460; }
        .status.success { background: #d4edda; color: #155724; }
        .status.error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>ğŸŒ ì–¸ì–´ ê°ì§€ ë””ë²„ê¹… ë„êµ¬</h1>
    
    <div class="debug-section">
        <h2>í˜„ì¬ ìƒíƒœ</h2>
        <div id="current-status"></div>
        <button onclick="updateStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
    </div>

    <div class="debug-section">
        <h2>ë””ë²„ê¹… ë„êµ¬</h2>
        <button onclick="debugLanguage()">ì–¸ì–´ ì„¤ì • ë””ë²„ê¹…</button>
        <button onclick="testIPDetection()">IP ê°ì§€ í…ŒìŠ¤íŠ¸</button>
        <button onclick="resetLanguage()">ì–¸ì–´ ì„¤ì • ì´ˆê¸°í™”</button>
        <button onclick="forceDetectLanguage()">ê°•ì œ ì–¸ì–´ ê°ì§€</button>
        <button onclick="manualLanguageDetection()">ìˆ˜ë™ ì–¸ì–´ ê°ì§€</button>
    </div>

    <div class="debug-section">
        <h2>ë¡œê·¸</h2>
        <div id="log-output"></div>
        <button onclick="clearLog()">ë¡œê·¸ ì§€ìš°ê¸°</button>
    </div>

    <script src="assets/js/language-router.js"></script>
    <script>
        // ë¡œê·¸ ì¶œë ¥ í•¨ìˆ˜
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log-output');
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(logEntry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        // ì½˜ì†” ë¡œê·¸ë¥¼ í˜ì´ì§€ì—ë„ í‘œì‹œ
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            addLog(args.join(' '));
        };

        const originalError = console.error;
        console.error = function(...args) {
            originalError.apply(console, args);
            addLog(args.join(' '), 'error');
        };

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus() {
            const statusDiv = document.getElementById('current-status');
            
            if (typeof LanguageRouter === 'undefined') {
                statusDiv.innerHTML = `<div class="status error">âŒ LanguageRouterê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.</div>`;
                return;
            }
            
            try {
                const debugInfo = LanguageRouter.getLanguageDebugInfo();
                statusDiv.innerHTML = `<pre>${JSON.stringify(debugInfo, null, 2)}</pre>`;
            } catch (error) {
                statusDiv.innerHTML = `<div class="status error">âŒ ìƒíƒœ ì¡°íšŒ ì‹¤íŒ¨: ${error.message}</div>`;
            }
        }

        // ë””ë²„ê¹… í•¨ìˆ˜ë“¤
        function debugLanguage() {
            addLog('ğŸ” ì–¸ì–´ ë””ë²„ê¹… ì‹œì‘...');
            
            if (typeof LanguageRouter === 'undefined') {
                addLog('âŒ LanguageRouterê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            try {
                const debugInfo = LanguageRouter.getLanguageDebugInfo();
                console.table(debugInfo);
                addLog('âœ… ë””ë²„ê·¸ ì •ë³´ë¥¼ ì½˜ì†”ì— ì¶œë ¥í–ˆìŠµë‹ˆë‹¤.', 'success');
                updateStatus();
            } catch (error) {
                addLog(`âŒ ë””ë²„ê¹… ì‹¤íŒ¨: ${error.message}`, 'error');
            }
        }

        async function testIPDetection() {
            addLog('ğŸ§ª IP ê°ì§€ API í…ŒìŠ¤íŠ¸ ì‹œì‘...');
            
            const apis = [
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://api.ipgeolocation.io/ipgeo?apiKey=demo'
            ];
            
            for (const api of apis) {
                try {
                    addLog(`Testing ${api}...`);
                    const response = await fetch(api);
                    const data = await response.json();
                    addLog(`âœ… ${api} ì„±ê³µ`, 'success');
                    
                    // ë°ì´í„°ë¥¼ ë³´ê¸° ì¢‹ê²Œ í‘œì‹œ
                    const countryCode = data.country_code || data.country || data.countryCode;
                    const country = data.country_name || data.country || data.country_name;
                    const city = data.city || data.city;
                    const ip = data.ip || data.query;
                    
                    addLog(`ğŸŒ IP: ${ip}, êµ­ê°€: ${country} (${countryCode}), ë„ì‹œ: ${city}`, 'info');
                    console.log(`${api} ìƒì„¸ ë°ì´í„°:`, data);
                } catch (error) {
                    addLog(`âŒ ${api} ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
        }

        function resetLanguage() {
            addLog('ğŸ”„ ì–¸ì–´ ì„¤ì • ì´ˆê¸°í™”...');
            
            if (typeof LanguageRouter === 'undefined') {
                addLog('âŒ LanguageRouterê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.', 'error');
                // ì§ì ‘ localStorage ì´ˆê¸°í™”
                localStorage.removeItem('preferredLanguage');
                localStorage.removeItem('languageDetected');
                localStorage.removeItem('detectedCountry');
                localStorage.removeItem('detectionMethod');
                addLog('âœ… localStorageì—ì„œ ì§ì ‘ ì–¸ì–´ ì„¤ì •ì„ ì´ˆê¸°í™”í–ˆìŠµë‹ˆë‹¤.', 'success');
            } else {
                try {
                    LanguageRouter.resetLanguageSettings();
                    addLog('âœ… ì–¸ì–´ ì„¤ì •ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                } catch (error) {
                    addLog(`âŒ ì´ˆê¸°í™” ì‹¤íŒ¨: ${error.message}`, 'error');
                }
            }
            
            updateStatus();
        }

        async function forceDetectLanguage() {
            addLog('ğŸŒ ê°•ì œ ì–¸ì–´ ê°ì§€ ì‹œì‘...');
            try {
                // LanguageRouterê°€ ë¡œë“œë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (typeof LanguageRouter === 'undefined') {
                    addLog('âŒ LanguageRouterê°€ ë¡œë“œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.', 'error');
                    return;
                }
                
                const result = await LanguageRouter.detectLanguageByIP();
                addLog(`âœ… ê°ì§€ëœ ì–¸ì–´: ${result}`, 'success');
                updateStatus();
            } catch (error) {
                addLog(`âŒ ì–¸ì–´ ê°ì§€ ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('Language detection error:', error);
            }
        }

        function clearLog() {
            document.getElementById('log-output').innerHTML = '';
        }

        // ìˆ˜ë™ ì–¸ì–´ ê°ì§€ (LanguageRouter ì—†ì´)
        async function manualLanguageDetection() {
            addLog('ğŸ§ª ìˆ˜ë™ ì–¸ì–´ ê°ì§€ ì‹œì‘...');
            
            const apis = [
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://api.ipgeolocation.io/ipgeo?apiKey=demo'
            ];
            
            let detectedLang = 'en';
            
            for (const api of apis) {
                try {
                    addLog(`ğŸŒ ${api} ì‹œë„ ì¤‘...`);
                    const response = await fetch(api);
                    const data = await response.json();
                    
                    const countryCode = data.country_code || data.country || data.countryCode;
                    const country = data.country_name || data.country || data.country_name;
                    const city = data.city || data.city;
                    const ip = data.ip || data.query;
                    
                    addLog(`âœ… ê°ì§€ë¨ - IP: ${ip}, êµ­ê°€: ${country} (${countryCode}), ë„ì‹œ: ${city}`, 'success');
                    
                    // ì–¸ì–´ ê²°ì • ë¡œì§
                    if (countryCode === 'KR') {
                        detectedLang = 'kr';
                        addLog('ğŸ‡°ğŸ‡· í•œêµ­ ì‚¬ìš©ìë¡œ ê°ì§€ â†’ í•œêµ­ì–´ ì„¤ì •', 'success');
                    } else if (countryCode === 'JP') {
                        detectedLang = 'jp';
                        addLog('ğŸ‡¯ğŸ‡µ ì¼ë³¸ ì‚¬ìš©ìë¡œ ê°ì§€ â†’ ì¼ë³¸ì–´ ì„¤ì •', 'success');
                    } else {
                        detectedLang = 'en';
                        addLog('ğŸŒ í•´ì™¸ ì‚¬ìš©ìë¡œ ê°ì§€ â†’ ì˜ì–´ ì„¤ì •', 'success');
                    }
                    
                    // ì²« ë²ˆì§¸ ì„±ê³µí•œ APIë¡œ ê²°ì •
                    break;
                    
                } catch (error) {
                    addLog(`âŒ ${api} ì‹¤íŒ¨: ${error.message}`, 'error');
                    continue;
                }
            }
            
            addLog(`ğŸ¯ ìµœì¢… ê°ì§€ ì–¸ì–´: ${detectedLang}`, 'success');
            
            // localStorageì— ì €ì¥
            localStorage.setItem('preferredLanguage', detectedLang);
            localStorage.setItem('languageDetected', 'true');
            
            addLog('ğŸ’¾ ì–¸ì–´ ì„¤ì •ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ì„¸ìš”.', 'success');
            updateStatus();
        }

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìƒíƒœ ì—…ë°ì´íŠ¸
        window.addEventListener('load', () => {
            updateStatus();
            addLog('ğŸš€ ë””ë²„ê¹… ë„êµ¬ ì¤€ë¹„ ì™„ë£Œ');
        });
    </script>
</body>
</html> 