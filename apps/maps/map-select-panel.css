/* Map Select Panel Styles */

#map-select-panel {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 320px;
  max-height: calc(100vh - 40px);
  background: transparent;
  border-radius: 0;
  color: white;
  z-index: 1000;
  display: flex;
  flex-direction: column;
  overflow: visible;
  gap: 10px;
}

/* 탭 */
#map-tabs {
  display: flex;
  flex-direction: column;
  padding: 0;
  gap: 10px;
  background: transparent;
}

.map-tab {
  width: 100%;
  height: auto;
  min-height: 0;
  padding: 0;
  background-size: contain;
  background-position: center;
  background-repeat: no-repeat;
  color: #fff;
  border: none;
  cursor: pointer;
  font-size: 18px;
  font-weight: 600;
  transition: all 0.3s ease;
  position: relative;
  display: block;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
  background-color: transparent;
  /* 이미지 비율 유지 (가로로 긴 이미지) */
  aspect-ratio: 4 / 1;
  filter: brightness(0.5);
}

/* 배경 이미지는 JavaScript에서 동적으로 설정됨 */

.map-tab span {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  z-index: 1;
  pointer-events: none;
  white-space: nowrap;
}

.map-tab:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

.map-tab.active {
  filter: brightness(1.2);
  transform: scale(1.05);
}

/* active 상태가 아닐 때 호버 효과 */
.map-tab:not(.active):hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

/* active 상태일 때 호버 효과 */
.map-tab.active:hover {
  transform: scale(1.08);
  filter: brightness(1.3);
}

.map-tab[data-map-id="palace"] {
  scale: 125%;
}

/* 메멘토스 탭 이미지 크기 조정 */
.map-tab[data-map-id="mementoes"] {
  background-size: 90%;
}

/* 팰리스 탭 글씨 위치 - 아래로 1% 이동 */
.map-tab[data-map-id="palace"] span {
  transform: translate(-50%, calc(-50% + 10%)) rotate(-5deg);
  
}

/* 메멘토스 탭 글씨 위치 - 왼쪽으로 5% 이동 */
.map-tab[data-map-id="mementoes"] span {
  transform: translate(calc(-50% - 30%), -50%) rotate(1deg);
  font-size: 20px;
}

/* 메멘토스 탭 호버 효과 */
.map-tab[data-map-id="mementoes"]:hover {
  transform: scale(1.05);
  filter: brightness(1.1);
}

/* 카테고리 드롭다운 */
#category-select-container {
  padding: 15px 20px;
  border-bottom: 1px solid #333;
}

.category-select {
  width: 100%;
  padding: 10px;
  background: #1a1a1a;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  margin-top: 10px;
}

.category-select:focus {
  outline: none;
  border-color: #800000;
}

/* 맵 리스트 컨테이너 */
#map-list-container {
  flex: 1;
  overflow-y: auto;
  overflow-x: hidden;
  padding: 0;
  background: transparent;
  border-radius: 0;
  margin-top: 10px;
}

#map-list {
  padding: 0;
  display: flex;
  flex-direction: column;
  gap: 8px;
}

/* 맵 아이템 스타일 - 배경과 텍스트 분리 */
.map-item {
  display: flex;
  align-items: center;
  padding: 12px 20px;
  color: #ffffff;
  text-decoration: none;
  transition: all 0.3s ease;
  width: 100%;
  box-sizing: border-box;
  outline: none;
  -webkit-tap-highlight-color: transparent;
  background-color: transparent;
  cursor: pointer;
  position: relative;
  margin-bottom: 0;
  overflow: visible;
}


/* 맵 아이템 배경 폴리곤 (검정) - 맨 뒤 */
.map-item-bg {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #000000;
  z-index: 1;
  pointer-events: none;
}

/* 각 맵 아이템 배경에 서로 다른 폴리곤 모양 적용 (0-2%, 98-100% 범위 내) */
.map-item:nth-child(1) .map-item-bg {
  clip-path: polygon(0% 2%, 99% 11%, 95% 95%, 2% 94%);
}

.map-item:nth-child(2) .map-item-bg {
  clip-path: polygon(1% 1%, 98% 10%, 96% 96%, 1% 95%);
}

.map-item:nth-child(3) .map-item-bg {
  clip-path: polygon(0% 2%, 100% 9%, 98% 97%, 2% 94%);
}

.map-item:nth-child(4) .map-item-bg {
  clip-path: polygon(2% 0%, 98% 11%, 96% 95%, 0% 96%);
}

.map-item:nth-child(5) .map-item-bg {
  clip-path: polygon(0% 1%, 99% 8%, 97% 98%, 2% 99%);
}

.map-item:nth-child(6) .map-item-bg {
  clip-path: polygon(1% 2%, 98% 10%, 95% 95%, 2% 97%);
}

.map-item:nth-child(7) .map-item-bg {
  clip-path: polygon(0% 1%, 100% 11%, 96% 96%, 1% 94%);
}

.map-item:nth-child(8) .map-item-bg {
  clip-path: polygon(2% 2%, 98% 9%, 98% 97%, 0% 95%);
}

.map-item:nth-child(9) .map-item-bg {
  clip-path: polygon(0% 2%, 99% 8%, 95% 98%, 2% 95%);
}

.map-item:nth-child(10) .map-item-bg {
  clip-path: polygon(1% 0%, 98% 12%, 96% 95%, 0% 96%);
}

/* 10개 이상인 경우 반복 */
.map-item:nth-child(n+11) .map-item-bg {
  clip-path: polygon(0% 2%, 99% 11%, 95% 95%, 2% 94%);
}

.map-item:hover .map-item-bg {
  background-color: rgb(33, 33, 33);
}

.map-item.active {
  position: relative;
}

/* 활성화된 메뉴의 빨간 폴리곤 레이어 - map-select-panel 안에 추가됨 (JavaScript) */
.red-polygon-layer {
  position: absolute;
  background-color: rgba(128, 0, 0, 0.75);
  animation: subtle-liquid 2s infinite linear;
  z-index: 1001;
  pointer-events: none;
  /* clip-path 없이 배경을 벗어날 수 있도록 함 */
  /* 검정 폴리곤(맨 뒤, z-index: 1000) < 빨간 폴리곤(중간, z-index: 1001) < 글씨(맨 앞, z-index: 1002) 순서 */
  /* map-select-panel 안에 추가되어 같은 stacking context에 있음 */
}


.map-item span {
  position: relative;
  z-index: 1002;
  color: #ffffff;
  font-weight: normal;
}

.map-item.active span {
  font-weight: 600;
  /* 글씨가 빨간 폴리곤 위에 오도록 (z-index: 1002) */
}

.map-item span {
  font-size: 14px;
  margin-left: 10px;
}

.map-item.has-submaps {
  padding-right: 50px;
}

.map-item-toggle {
  position: absolute;
  right: 16px;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  color: #aaa;
  font-size: 12px;
  transition: transform 0.3s ease;
  z-index: 1003;
  pointer-events: none;
}

.map-item.expanded .map-item-toggle {
  transform: rotate(90deg);
}

/* 하위 메뉴 리스트 - 하위 메뉴에 붙어있고 가로폭 3%~96% */
.map-sub-list {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-in-out, opacity 0.3s ease-in-out, visibility 0.3s ease-in-out, margin-top 0.3s ease-in-out, padding 0.3s ease-in-out, background 0.3s ease-in-out;
  background: transparent;
  width: 93%;
  margin-left: 3%;
  margin-top: 0;
  padding: 0;
  display: block;
  opacity: 0;
  visibility: hidden;
  z-index: 0;
  position: relative;
}

.map-item.expanded + .map-sub-list,
.map-sub-item.expanded + .map-sub-list {
  max-height: 2000px;
  margin-top: -20px;
  background: rgb(188 188 188);
  padding: 8px;
  border-radius: 0px;
  overflow: hidden;
  opacity: 1;
  visibility: visible;
}

/* 하위 맵 아이템 - 연한 회색 배경, 활성화 시 빨간 폴리곤 */
.map-sub-item {
  display: flex;
  align-items: center;
  padding: 12px 20px 12px 48px;
  color: #1e1e1e;
  text-decoration: none;
  transition: all 0.3s ease;
  width: 100%;
  box-sizing: border-box;
  outline: none;
  -webkit-tap-highlight-color: transparent;
  background-color: transparent;
  cursor: pointer;
  position: relative;
  margin-bottom: 4px;
  border-radius: 2px;
  overflow: visible;
  isolation: isolate;
}

.map-sub-item:last-child {
  margin-bottom: 0;
}

.map-sub-item:hover {
  background-color: rgba(255, 255, 255, 0.1);
}

.map-sub-item.active {
  background-color: transparent;
  color: #ffffff;
  position: relative;
  z-index: 1002;
}

/* 활성화된 하위 메뉴의 빨간 폴리곤 레이어는 .red-polygon-layer 클래스로 공통 스타일 사용 */

.map-sub-item.active span {
  position: relative;
  z-index: 1002;
  font-weight: 600;
  /* 글씨가 빨간 폴리곤 위에 오도록 - stacking context를 벗어나기 위해 */
  transform: translateZ(0);
  isolation: isolate;
}

.map-sub-item span {
  position: relative;
  z-index: 1002;
  font-size: 13px;
  margin-left: 0;
  color: #111;
}

.map-sub-item.has-submaps {
  padding-right: 50px;
}

/* 활성 애니메이션 */
@keyframes subtle-liquid {
  0% { clip-path: polygon(0% 2%, 99% 9%, 94% 99%, 4% 94%);}
  10% { clip-path: polygon(1% 1%, 98% 7%, 93% 100%, 5% 95%);}
  20% { clip-path: polygon(-1% 3%, 100% 5%, 95% 98%, 3% 93%);}
  30% { clip-path: polygon(0% 3%, 98% 2%, 93% 96%, 5% 95%);}
  40% { clip-path: polygon(1% 1%, 99% -1%, 95% 98%, 4% 93%);}
  50% { clip-path: polygon(0% 0%, 100% 2%, 93% 100%, 3% 95%);}
  60% { clip-path: polygon(-1% 3%, 98% 1%, 94% 98%, 5% 94%);}
  70% { clip-path: polygon(1% 2%, 99% -1%, 95% 96%, 4% 95%);}
  80% { clip-path: polygon(0% 1%, 100% 2%, 93% 98%, 3% 93%);}
  90% { clip-path: polygon(-1% 3%, 98% 4%, 94% 100%, 5% 95%);}
  100% { clip-path: polygon(0% 2%, 99% 7%, 94% 99%, 4% 94%);}
}

/* 반응형 */
@media screen and (max-width: 1024px) {
  #map-select-panel {
    width: 280px;
  }
}

@media screen and (max-width: 768px) {
  #map-select-panel {
    width: 240px;
  }
  
  .map-tab {
    padding: 12px 15px;
    font-size: 14px;
  }
}
